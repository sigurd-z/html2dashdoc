<html><head>
<meta charset="utf-8">
<title>Cocos骨骼动画功能解密 -  CocoaChina 苹果开发中文站 - 最热的iPhone开发社区 最热的苹果开发社区 最热的iPad开发社区</title>
<meta content="Cocos引擎,骨骼动画iPhone开发,iOS开发,iPad开发,Mac开发,苹果开发中文站,iPhone开发中文站,CocoaChina首页, Mac OS开发, Cocoa介绍,移动互联网,触控科技,Cocoa,Apple,developer,iOS,iPhone,iPad,iMac,iPod Touch,iPhone5,iPhone4S,iPad3,招聘,iPhone程序员,Objective-c,iPhone应用外包,ios6,ios面试,Cocos2d-x,cocos2d,iTunes,App Store,苹果开发" name="keywords"/>
<meta content=" - CocoaChina 开发讨论区 最热的iOS开发论坛| 最热的Mac开发论坛 | 最热的iPhone开发论坛 | 最热的iPad开发论坛" name="description"/>
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="width=device-width, initial-scale=1" name="viewport">
<meta content="3300a939a1098c27e94457b75a0bb8c1" name="baidu-tc-cerfication"/>
<link href="src/a84898c7e6056d1260de02fbe818b59e.css" media="all" rel="stylesheet">
<link href="src/c0597c37aa26d8163210b6c965c90193.css" media="all" rel="stylesheet">
<link href="src/d489a5f4b1e2af09b4874b9d8d44c7a2.css" rel="stylesheet">
<link href="src/b5f6d4d81287e6040d1271874f705098.css" rel="stylesheet">
<link href="src/7e4d01d9c184dd72d4df6f0fba5b2239.css" rel="stylesheet"/>
<script src="src/a769fe53451c6abe32a2409f213c856c.js" type="text/javascript"></script>
<script src="src/736ecafd352274eea593c95848b629b4.js" type="text/javascript"></script>
<script src="src/78baea099161f999e575b28991cb48cf.js" type="text/javascript"></script>
</link></link></link></link></meta></meta></meta></head><body><div class="field_body" id="detailbody">
<p style="text-align:center"><img alt="cocos横版LOGO.jpg" src="src/916a8efce2fc9ca796e21478ebff7337.jpg" title="1441608744570373.jpg"/></p><p>在游戏中，人物的各种动作是必不可少，一般实现人物动作的方式有两种，序列帧动画或骨骼动画。Cocos在更新到2.x版本之后，便没有了骨骼动画的功能，使得开发者非常困扰。终于在本次更新中，Cocos编辑器将骨骼动画添加了回来！（注：新版本骨骼动画需要Cocos2d-x3.8版本）</p><p><span style="color: rgb(0, 176, 80);"><strong>骨骼动画与序列帧动画</strong></span></p><p>序列帧动画是将，动画的每一帧都是人物动作的一个快照，序列帧的帧数直接决定动画的流畅度和平滑效果，但是同时，序列帧的数量也严重影响着资源包体积及图片资源加载速度。而骨骼动画则是把人物拆开成碎块，然后将人物各个部分拼接到一起，并为其各部分图片绑定到一根根互相作用连接的"骨头"上，通过控制这些骨骼的位置、旋转方向和放大缩小便可以做出非常流畅细腻的动画。同时骨骼动画编辑方式和Flash非常相似，对于擅长使用Flash的动画编辑师来说上手非常容易。</p><p><span style="color: rgb(0, 176, 80);"><strong>新建骨骼动画</strong></span></p><p>首先点击屏幕右上角的 文件-&gt;新建文件（快捷键：Command+N），打开如下界面，选择骨骼动画，点创建：<br/></p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/6d995e22d69b63e985c2ffd4c18712f6.jpg" title="1441608791447823.jpg"/></p><p><strong>主界面介绍</strong></p><p>首先我们需要了解一下编辑器界面中各个部分的功能，</p><p>我们常用的空间的位置已经不需要使用了</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/ea08199248a086f4bf9ff08fcf45fdc3.jpg" title="1441608875216383.jpg"/></p><p>1.资源列表，这里显示你项目中所有资源，如果想编辑骨骼，首先需要将骨骼动画的图片导入进来。</p><p>2.渲染区域，也就是我们的画布。这里是资源布局的编辑区域，在这个区域可以各个图片和骨骼进行移动，缩放，旋转的操作，所有的图片、骨骼、动画的绑定与编辑都在这个区域完成</p><p>3.快捷菜单栏，快捷菜单栏中包涵一些常用操作，这里的每个按钮的用途会在下边介绍。</p><p>4.属性栏，当选中一个对象(图片/骨骼)时，属性栏会显示出该对象的所有属性。通过属性栏可以非常精准的修改对象的属性设置，并且立刻在渲染区域显示出来。</p><p>5.帧曲线设置面板，在这个面板中，可以设置动画的动画曲线。其中预设了一些效果，也可以自己通过修改曲线自定义效果，以修改动画的播放曲线（例如，挥剑动画，开始时候挥剑速度慢，然后逐渐变快，就可以通过这里轻松设置）。</p><p>6.动画列表，这个面板会显示出所有的对象，以及对象的关键帧。通过设置在关键帧中骨骼及图片的变化就可以编辑出流畅的骨骼动画了。</p><p><strong>快捷栏介绍</strong></p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/7d321b25e9e97f2553b0ed4575e09d4f.jpg" title="1441608906315300.jpg"/></p><p>1.移动画布,永远移动渲染区域（画布）的显示位置</p><p>2.平移，用于移动对象的位置，修改对象Position。</p><p>3.旋转，对象进行旋转操作</p><p>4.缩放，对对象进行缩放操作</p><p>平移、旋转、缩放三个操作选中对象时候，会出现如下图形：</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/c9301f3f99cc9f999f48ffb215f9de89.jpg" title="1441608939846563.jpg"/></p><p><span style="line-height: 1.8;">对于平移或缩放操作，两个箭头会分别修改x,y方向的位置或大小。点击中间方形区域，则可以同时修改x,y的位置或大小。</span></p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/c032a84888fdc87f9288dd5a5cf2feb7.jpg" title="1441608971873794.jpg"/></p><p>对于旋转操作，两个箭头则会逆时针/顺时针旋转对象。</p><p>5.创建骨骼，该工具可以快速连续创建骨骼，选中该工具后，在画布上进行点击鼠标左键，然后移动鼠标，选择合适的大小后，再次点击鼠标左键，则会创建一个骨骼，并且开启下一次的骨骼创建操作，点击鼠标右键，退出编辑状态。</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/65438fcac130c3345172213a1158ea95.jpg" title="1441609000182013.jpg"/></p><p style="text-align: center;">（指向渲染区域中心的坐标系表示该骨骼没有父骨骼）</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/d6f5ab459b952e39948649b11c9e4671.jpg" title="1441609045700209.jpg"/></p><p style="text-align: center;">（黄色箭头指向点为骨骼的头端是旋转、缩放、位移的中心（锚点），红色箭头指向则是骨骼的尾端，旋转骨骼时候，点击骨骼尾端可以很方便的对骨骼进行准确的旋转）<br/></p><p>6.绑定，绑定工具用于将骨骼和图片资源进行绑定，选中该工具后，点击要绑定的图片，会出现一个小箭头，再点击要绑定的骨骼即可将骨骼和图片进行绑定，绑定后的图片，会根据骨骼的旋转、移动、缩放等操作进行同步的改变。</p><p>同时，绑定工具亦可将骨骼与骨骼之间进行绑定，骨骼间绑定的方式与图片绑定方式类似：选中快捷菜单栏绑定工具，点击子骨骼a，移动鼠标会出现一个黄色的线，然后点击父骨骼b就可以了。将骨骼a绑定到骨骼b时，当骨骼b旋转、移动时，骨骼a相对于骨骼b的位置和旋转将不会改变。</p><p>（注：当勾选动画列表栏中的自动记录关键帧选项时，无法进行骨骼绑定操作）</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/1f9e24710c9e0ca0edb09d081c1f03b2.jpg" title="1441609093582381.jpg"/></p><p style="text-align: center;">（骨骼与骨骼间的绑定）</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/bd0239e61ecb6d5e01b367061dc291e1.jpg" title="1441609119143326.jpg"/></p><p style="text-align: center;">（图片与骨骼之间的绑定）</p><p>7.解绑，解除绑定操作，与第6个绑定相反。</p><p>8.隐藏/显示骨骼，可以切换骨骼对象的显示状态，关闭骨骼显示后，可以更好的查看各个图片。只针对图片进行操作，无需担心误修改骨骼对象。</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/ae007530c2d4288b4affb968a23bb31d.jpg" title="1441609154472558.jpg"/></p><p style="text-align: center;">（隐藏骨骼状态）</p><p>9.隐藏/显示皮肤，与第8个功能类似，可以切换图片(皮肤)的显示状态，只针对骨骼对象进行操作，无需担心误修改图片。</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/8a75d3bb225133d3aeabbc82c61747ab.jpg" title="1441609190139728.jpg"/></p><p style="text-align: center;">（隐藏皮肤状态）</p><p>10.查看骨骼关系，这个功能可以更好地对骨骼对象及图片进行绑定管理操作，通过列表形式清楚的展现出各个对象之间的绑定关系。</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/699a3ca56ac88360b42156f331d132fb.jpg" title="1441609221842394.jpg"/></p><p>对编辑器的各个功能有了初步了解后，我们就可以开始编辑骨骼动画了。</p><p><strong>编辑骨骼动画</strong></p><p>1.首先在资源列表区域点击右键，选择 导入资源 ，也可以将资源直接拖拽进入资源列表（注意，这里不同动画之间的骨骼也尽量不要出现命名重复）</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/c53cc371d6741dbd3dac6276044decdd.jpg" title="1441609254869733.jpg"/></p><p>2.将资源列表中的图片拖拽到渲染区，并一一摆好位置</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/43c5e50a92521031050b8d8d4617e914.jpg" title="1441609284510647.jpg"/></p><p>3.根据摆放好的图片，创建骨骼：选中快捷菜单栏中的创建骨骼按钮，在人物身体部位（图片）的轴心（旋转中心）上单击左键，将鼠标移动到旋转半径的另一头，再次点击左键，便可以创建出一个骨骼，然后点击鼠标右键，取消骨骼编辑。（重复以上操作直至创建好所有骨骼）</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/fb72b97924f333cffc22a912d4331e42.jpg" title="1441609321187981.jpg"/></p><p>4.将人物身体各部分图片与骨骼绑定：点击快捷菜单栏中的绑定按钮，然后单击左键选择要绑定的图片，这时移动数遍会出现一个黄色的箭头，将鼠标移动到要绑定的骨骼上边，再次点击左键，便可将图片与骨骼绑定。这时，黄色箭头会变为红色箭头。（重复以上操作直至将所有图片与骨骼绑定完毕）</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/eb9c569d016fb1c2486149fb62862ced.jpg" title="1441609352284591.jpg"/></p><p>如果希望解除绑定，选择要解除绑定的骨骼，点击快捷菜单栏中的"解除"按钮即可。</p><p>5.创建骨骼的父子关系：本步骤操作是将骨骼与骨骼之间进行绑定，形成一种父子关系，当父骨骼产生位移或旋转时候，子骨骼也会跟随父骨骼变化。</p><p>操作步骤与绑定图片相似，首选点击快捷菜单栏的绑定按钮，然后左键单击要绑定的子骨骼，然后将鼠标移动到要绑定的父骨骼上，再次单击左键即可。</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/0c7d0d8e462b4eb9657676aec899eb20.jpg" title="1441609382512481.jpg"/></p><p style="text-align: center;">（骨骼间的父子绑定关系）</p><p>6.编辑动画，当所有的骨骼和图片之间的关系设置完毕后，就可以开始编辑骨骼动画了。</p><p>（1）先添加第一帧（初始位置的关键帧），先将0帧位置的所有对象都选中，然后右键选择 "添加帧"</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/26d9a10943a7d3854f1ab1b40f6e2491.jpg" title="1441609414645898.jpg"/></p><p>将初始位置添加关键帧后，为了让动画能够形成一个闭环，我们需要将动画的首尾状态设置的一致，全选所有对象的初始位置的关键帧，右键-&gt;复制，然后到动画最后一帧（例如1秒的动画，最后一帧默认为60帧），右键-&gt;粘贴。</p><p>（2）勾选自动记录关键帧的复选框，开始编辑其他帧，将时间轴拖动到到某一帧上(如10帧)，对人物骨骼的位置角度进行编辑，这时，编辑器将会自动记录一个关键帧，两个关键帧之间会自动进行补帧，以保证动画播放流畅。（补帧是不会显示出来的）</p><p style="text-align:center"><span class="Apple-tab-span" style="line-height: 1.8; white-space: pre;"><img alt="未标题-1.jpg" src="src/9044daf3d18ea5c89b7baf0dba022a00.jpg" title="1441609440677509.jpg"/></span></p><p>（3）编辑完动画后，需要对动画进行分组，以方便后边播放，点击动画栏中的小加号，输入一个动画名称，然后选择动画在时间轴的帧数范围即可</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/cc1bd1c443c2e2bea93781aaa5f930db.jpg" title="1441609470657222.jpg"/></p><p>（4）将动画编辑好后，点击三角按钮可以进行播放，查看动画效果</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/379fad38aed0a777e21264d5fbe56ef6.jpg" title="1441609495284267.jpg"/></p><p style="text-align: center;">（图中60fps表示每秒包涵多少帧，帧数越高动画越细腻，一般保持与屏幕刷新帧数相同即可（默认60帧）即可）</p><p>（5）为骨骼动画添加帧事件：帧事件的意思是在骨骼动画播放到某帧的时候，会产生一个事件，程序可以对事件进行监听，当收到事件时候，进行不同的动作，例如播放另外一个动画，开枪，或者播放技能效果等。</p><p>首先我们需要选中一个帧作为帧事件触发的时机。</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/f21d963f1302fb4ba461ce85e1b8d096.jpg" title="1441609563238653.jpg"/></p><p>接下来，在属性面板中，展开高级属性菜单，在帧事件栏中输入帧事件的名字（可以重复，除非特殊需要，请不要重复）即可。</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/47dfc626e9f186c3b9aeec0e6772a071.jpg" title="1441609600622672.jpg"/></p><p>7.导出骨骼动画：点击屏幕左上角的使用上次设置发布图标，可以导出骨骼动画，默认是csb格式，可以通过点击边上的小箭头进行导出设置。<br/></p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/99f0afcc3c3bfa1b5b9210bd2cc3d482.jpg" title="1441609623805478.jpg"/></p><p>8.在Cocos编辑器的Layer或者Scene中加载编辑好的骨骼动画</p><p>新版骨骼动画在Cocos的加载方式比加载1.6版本的骨骼动画要方便一些，只需要从资源面板中直接拖入Layer或者Scene的画布上即可。（1.6版本的骨骼动画需要使用自定义控件加载）<br/></p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/0927e8eec6c1d96f7730b1e82ed7efac.jpg" title="1441609656402604.jpg"/></p><p>加载动画后，我们可以在属性面板中对骨骼动画进行一些设置，在特写栏目下，我们可以设置动画的播放。</p><p>嵌套动画的类型有三种</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/bdecf64a2bbb58dd010fc49de7e5de42.jpg" title="1441609685893424.jpg"/></p><p>SingleFrame表示只显示一个静态的动画（也就是骨骼动画的某一帧，下边的帧就是设定显示的帧数）</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/6da687234bcffb8fe0527d7acf163ed3.jpg" title="1441609714559873.jpg"/></p><p>NoLoopAction与LoopAction的界面是一样的，这个用于设置播放的动画，下边名称指的是播放哪个动画。（NoLoopAction不循环播放，LoopAction循环播放）</p><p>9.最后，我们可以在Layer或者Scene的动画栏中，设置在某关键帧切换骨骼动画所播放的动画以及是否循环的状态：</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/d1664a4b12dae2f5c0a23db51a533443.jpg" title="1441609740469358.jpg"/></p><p><strong>在程序中应用骨骼动画</strong></p><p>Cocos编辑器导出的骨骼动画可以很方便的放到Cocos的项目中使用，首先将导出的骨骼动画和图片资源拷贝到项目的Resource目录下。</p><p>在Cocos项目中使用骨骼动画很简单(以C++为例)(注意：新版骨骼动画加载方式与1.6版本不同)</p><pre class="brush:js;toolbar:false">//首先通过CSLoader读入Cocos编辑器导出的csb文件，并将CSLoader返回的Node转换为SkeletonNode*类型
SkeletonNode* skeletonNode = static_cast(CSLoader::createNode("DemoPlayer.csb"));
//获得到骨骼节点之后，可以对骨骼节点的Scale、Position等进行设置
skeletonNode-&gt;setScale(0.2f);
skeletonNode-&gt;setPosition(150, 150);
//然后将骨骼节点添加到父节点上
this-&gt;addChild(skeletonNode);
//接下来，再次通过CSLoader读入Cocos编辑器导出的csb文件，创建一个ActionTimeline对象，这个对象存储着骨骼节点的所有动画
ActionTimeline* action = CSLoader::createTimeline("DemoPlayer.csb");
//我们为骨骼节点的动画设置一个tag值方便后边取出动画，建议这里使用枚举的形式来定义tag值（为了方便这里直接写100了）
action-&gt;setTag(100);
skeletonNode-&gt;runAction(action);
//播放action中的动画(参数1:动画名称   参数2:是否循环播放)
action-&gt;play("animation0", false);
//我们可以通过每个骨骼节点上边的某个皮肤(图片)的名字来获取这"块"骨骼
const std::string weapBoneName = "Layer20";
auto weaponHandeBone = skeletonNode-&gt;getBoneNode(weapBoneName);
//我们可以创建一个Sprite并把它加到刚刚获取到的那"块"骨骼的皮肤中
auto weapSkinToAdd = Sprite::create("ArcherPeng/girl_arms.png");
weapSkinToAdd-&gt;setName("Knife");
weapSkinToAdd-&gt;setPosition(Vec2(135, 23));
weapSkinToAdd-&gt;setScale(3.0f);
weapSkinToAdd-&gt;setRotation(86);
weaponHandeBone-&gt;addSkin(weapSkinToAdd, false);//加载到皮肤中
//然后将新加入的皮肤显示出来
weaponHandeBone-&gt;displaySkin(weapSkinToAdd, true);
//当然也可以换回原来的（"3"指的是"3.png"原先皮肤的名字）
weaponHandeBone-&gt;displaySkin("3", true);</pre><p><span style="line-height: 1.8;">上边我们谈到骨骼动画支持帧事件，下边我们来看一下如何注册一个帧事件的监听</span></p><pre class="brush:js;toolbar:false">//通过我们之前设置的tag，从骨骼节点中把action取出来，然后给其设置一个事件监听函数
skeletonNode-&gt;getActionByTag(100)-&gt;setFrameEventCallFunc([](Frame* frame)
{
    EventFrame* evnt = dynamic_cast(frame);//先对frame的类型进行转换
    if(!evnt)
        return;
    std::string str = evnt-&gt;getEvent();//取得事件的名字
    if (str == "testEvent")//根据事件名字进行相应处理
    {
        CCLOG("testEvent");
        //TODO
    }
   }
)</pre><p><span style="line-height: 1.8;">通过以上步骤，我们就可以灵活的使用Cocos的骨骼编辑器制作出非常流畅且节约资源的骨骼动画了。</span></p><p><span style="color: rgb(0, 176, 80);"><strong>对于1.6骨骼动画的兼容</strong></span></p><p>对于之前1.6版本制作的骨骼动画，Cocos编辑器是可以直接导入的， 文件-&gt;导入-&gt;导入1.6版本项目，选择1.6的骨骼动画项目即可</p><p style="text-align:center"><img alt="未标题-1.jpg" src="src/3ae90a5eba2666709a8619222dccb284.jpg" title="1441609809731147.jpg"/></p>
</div></body></html>