<html><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
<meta charset="utf-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="en" http-equiv="Content-Language">
<meta content="width=1020" name="viewport">
<title>Pomelo cli usage · NetEase/pomelo Wiki · GitHub</title>
<link href="/opensearch.xml" rel="search" title="GitHub" type="application/opensearchdescription+xml">
<link href="src/ad667adaa2cfe8f3caa4a41b7d0a79a1.png" rel="fluid-icon" title="GitHub">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="57x57">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="114x114">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="72x72">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="144x144">
<meta content="1401488693436528" property="fb:app_id">
<meta content="@github" name="twitter:site"/><meta content="summary" name="twitter:card"/><meta content="NetEase/pomelo" name="twitter:title"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="twitter:description"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" name="twitter:image:src"/>
<meta content="GitHub" property="og:site_name"/><meta content="object" property="og:type"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" property="og:image"/><meta content="NetEase/pomelo" property="og:title"/><meta content="https://github.com/NetEase/pomelo" property="og:url"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." property="og:description"/>
<meta content="https://api.github.com/_private/browser/stats" name="browser-stats-url">
<meta content="https://api.github.com/_private/browser/errors" name="browser-errors-url">
<link href="https://assets-cdn.github.com/" rel="assets">
<meta content="1000" name="pjax-timeout">
<meta content="/windows-tile.png" name="msapplication-TileImage">
<meta content="#ffffff" name="msapplication-TileColor">
<meta data-pjax-transient="" name="selected-link" value="repo_wiki">
<meta content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU" name="google-site-verification">
<meta content="UA-3769691-2" name="google-analytics">
<meta content="collector.githubapp.com" name="octolytics-host"/><meta content="github" name="octolytics-app-id"/><meta content="CA86616A:448D:EAD029C:5670C085" name="octolytics-dimension-request_id"/>
<meta content="/&lt;user-name&gt;/&lt;repo-name&gt;/wiki/show" data-pjax-transient="true" name="analytics-location"/>
<meta content="Rails, view, wiki#show" data-pjax-transient="true" name="analytics-event"/>
<meta class="js-ga-set" content="Logged Out" name="dimension1">
<meta content="github.com" name="hostname">
<meta content="" name="user-login">
<meta content="github.com" name="expected-hostname">
<link color="#4078c0" href="https://assets-cdn.github.com/pinned-octocat.svg" rel="mask-icon">
<link href="https://assets-cdn.github.com/favicon.ico" rel="icon" type="image/x-icon">
<meta content="5e69a256f5b847eca82097a6e603b569010944c2" name="form-nonce"/>
<link crossorigin="anonymous" href="src/350888e1495e7af27e01faa9d8291dee.css" media="all" rel="stylesheet"/>
<link crossorigin="anonymous" href="src/9fae9b7d8f0785d745a43c6465f74ae5.css" media="all" rel="stylesheet"/>
<meta content="cd9958d45e48e8e3157a320e9c346eaa" http-equiv="x-pjax-version">
<meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="description">
<meta content="github.com/NetEase/pomelo git https://github.com/NetEase/pomelo.git" name="go-import">
<meta content="1460597" name="octolytics-dimension-user_id"/><meta content="NetEase" name="octolytics-dimension-user_login"/><meta content="5880912" name="octolytics-dimension-repository_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_nwo"/><meta content="true" name="octolytics-dimension-repository_public"/><meta content="false" name="octolytics-dimension-repository_is_fork"/><meta content="5880912" name="octolytics-dimension-repository_network_root_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_network_root_nwo"/>
<link href="https://github.com/NetEase/pomelo/commits/master.atom" rel="alternate" title="Recent Commits to pomelo:master" type="application/atom+xml">
</link></meta></meta></meta></link></link></meta></meta></meta></meta></meta></meta></meta></meta></meta></meta></link></meta></meta></meta></link></link></link></link></link></link></meta></meta></meta></meta></head><body style="padding:0 25px;"><div class="gollum-markdown-content instapaper_body" id="wiki-body">
<div class="markdown-body">
<p>Pomelo-cli is a monitoring and management client which provides an interactive command line tool to help developers maintain the applications based on <a href="https://github.com/NetEase/pomelo">pomelo</a> framework.</p>
<h1>
<a aria-hidden="true" class="anchor" href="#installation" id="user-content-installation"><span class="octicon octicon-link"></span></a>Installation</h1>
<pre><code>npm install -g pomelo-cli
</code></pre>
<h1>
<a aria-hidden="true" class="anchor" href="#connecting-and-registering-to-master" id="user-content-connecting-and-registering-to-master"><span class="octicon octicon-link"></span></a>Connecting and Registering to Master</h1>
<pre><code>pomelo-cli -h &lt;master host&gt; -P &lt;master port&gt; -u &lt;username&gt; -p &lt;password&gt;
</code></pre>
<p>If you use <code>pomelo-cli</code> without parameters, the default parameters for pomelo-cli is as follows: </p>
<pre><code>pomelo-cli -h 127.0.0.1 -P 3005 -u monitor -p monitor
</code></pre>
<p>The access control is configured in config/adminUser.json, please refer to <a href="https://github.com/NetEase/pomelo-admin#user-level-control">admin access control</a> for more detail.</p>
<p>The commands such as kill, stop, add, enable, disable is in restricted to non-admin user.</p>
<h1>
<a aria-hidden="true" class="anchor" href="#commands" id="user-content-commands"><span class="octicon octicon-link"></span></a>Commands</h1>
<h4>
<a aria-hidden="true" class="anchor" href="#use" id="user-content-use"><span class="octicon octicon-link"></span></a>use</h4>
<p>Switch context for the cli environment, the new context can be serverId or all. After switching context, the following command will be applied to the new context util switching context to others, and all means global context, as below:</p>
<pre><code> &gt; use [ &lt;serverId&gt; | all ]

example:
 &gt; use area-server-1
 &gt; use all
</code></pre>
<h4>
<a aria-hidden="true" class="anchor" href="#quit" id="user-content-quit"><span class="octicon octicon-link"></span></a>quit</h4>
<p>exit pomelo-cli.</p>
<h4>
<a aria-hidden="true" class="anchor" href="#kill" id="user-content-kill"><span class="octicon octicon-link"></span></a>kill</h4>
<p>Close all servers.</p>
<p><strong>Note</strong>: Be careful to use this command.</p>
<h4>
<a aria-hidden="true" class="anchor" href="#exec" id="user-content-exec"><span class="octicon octicon-link"></span></a>exec</h4>
<p>Execute the specified script file in servers and then return the result.</p>
<pre><code>&gt; exec &lt;filepath&gt;
</code></pre>
<p>Here, filepath can be a relative path to pomelo-cli executing path or an absolute path. For example:</p>
<pre><code>example:
&gt; exec xxx.js
&gt; exec /home/user/xxx.js
</code></pre>
<p><a name="user-content-spec"></a>
The script file is executed by <a href="http://nodejs.org/api/vm.html">vm</a> module provided by node as a sandbox, and its executing context is:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> context <span class="pl-k">=</span> {
  app<span class="pl-k">:</span> <span class="pl-v">this</span>.<span class="pl-smi">app</span>, <span class="pl-c">// pomelo application instance</span>
  require<span class="pl-k">:</span> <span class="pl-c1">require</span>, <span class="pl-c">// global function of node  </span>
  os<span class="pl-k">:</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">"</span>os<span class="pl-pds">"</span></span>), <span class="pl-c">// os module of node</span>
  fs<span class="pl-k">:</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">"</span>fs<span class="pl-pds">"</span></span>), <span class="pl-c">// fs module of node</span>
  process<span class="pl-k">:</span> <span class="pl-c1">process</span>, <span class="pl-c">// process module of node</span>
  util<span class="pl-k">:</span> util <span class="pl-c">// util module of node</span>
};</pre></div>
<p>Result for the script executing is passed out by a global variable <strong>result</strong>, that means you should assign the executing result to <strong>result</strong> variable. Here is a sample script: </p>
<div class="highlight highlight-source-js"><pre><span class="pl-c">// getCPUs.js</span>
<span class="pl-k">var</span> cpus <span class="pl-k">=</span> <span class="pl-smi">os</span>.<span class="pl-en">cpus</span>();

<span class="pl-c">// declare result without `var` to make it be global</span>
result <span class="pl-k">=</span> <span class="pl-smi">util</span>.<span class="pl-en">inspect</span>(cpus, <span class="pl-c1">true</span>, <span class="pl-c1">null</span>); </pre></div>
<h4>
<a aria-hidden="true" class="anchor" href="#get" id="user-content-get"><span class="octicon octicon-link"></span></a>get</h4>
<p>Equals to app.get(key).</p>
<pre><code>&gt; get &lt;key&gt;
</code></pre>
<h4>
<a aria-hidden="true" class="anchor" href="#set" id="user-content-set"><span class="octicon octicon-link"></span></a>set</h4>
<p>Equals to app.set(key, value)</p>
<pre><code>&gt; set &lt;key&gt; &lt;value&gt;
</code></pre>
<p><strong>Note</strong>: Value here must be JSONfied. </p>
<h4>
<a aria-hidden="true" class="anchor" href="#add" id="user-content-add"><span class="octicon octicon-link"></span></a>add</h4>
<p>Add a server to pomelo cluster dynamically at runtime. Arguments for this command are shown as follows, they should be a set of key-value pair same as the configuration information in servers.json:</p>
<pre><code>example:
&gt; add host=127.0.0.1 port=3451 serverType=chat id=chat-server-2
&gt; add host=127.0.0.1 port=3152 serverType=connector id=connector-server-3 clientPort=3012 frontend=true
</code></pre>
<p><strong>Note</strong>: The complete arguments for a server is required when adding a new server, otherwise, the added server will run in a ill state.</p>
<h4>
<a aria-hidden="true" class="anchor" href="#stop" id="user-content-stop"><span class="octicon octicon-link"></span></a>stop</h4>
<p>Stop server specified by its argument.</p>
<pre><code>&gt; stop &lt;serverId&gt;

example: 
&gt; stop area-server-1
</code></pre>
<h4>
<a aria-hidden="true" class="anchor" href="#show" id="user-content-show"><span class="octicon octicon-link"></span></a>show</h4>
<p>Show information such as servers, connections, etc.</p>
<pre><code>&gt; show [servers|connections|logins|modules|status|proxy|handler|components|settings]

example:
&gt; show servers
&gt; show connections
&gt; show proxy
&gt; show handler
&gt; show logins
</code></pre>
<p><strong>Note</strong>: This command should be executed under a certain server context not global context except <code>show servers</code>, which can be executed under any contexts. </p>
<h4>
<a aria-hidden="true" class="anchor" href="#enable" id="user-content-enable"><span class="octicon octicon-link"></span></a>enable</h4>
<p>Enable an admin module or enable an app settings. </p>
<pre><code>&gt; enable [ module &lt;moduleId&gt; | app &lt;settingKey&gt; ]

example:
&gt; enable module systemInfo
&gt; enable app systemMonitor
</code></pre>
<h4>
<a aria-hidden="true" class="anchor" href="#disable" id="user-content-disable"><span class="octicon octicon-link"></span></a>disable</h4>
<p>Oppisite to enable.</p>
<pre><code>&gt; disable [ module &lt;moduleId&gt;|app &lt;settingKey&gt; ]

example:
&gt; disable module systemInfo
&gt; disable app systemMonitor
</code></pre>
<h4>
<a aria-hidden="true" class="anchor" href="#dump" id="user-content-dump"><span class="octicon octicon-link"></span></a>dump</h4>
<p>Make a dump of v8 heap and cpu for later inspection. </p>
<pre><code>&gt; dump [ cpu | memory ] &lt;filepath&gt; &lt;times&gt; [--force]

example:
&gt; dump cpu /home/xxx/ test 5
&gt; dump memory /home/xxx/ test
</code></pre>
<p><strong>Note</strong>: times argument is used in cpu dump indicates how long does cpu dump spends in seconds, filepath indicates where to place the dump file. You can use the --force to overwrite the existed file.</p>
<pre><code>example: 
&gt; dump cpu /home/xxx/ test 5 --force
&gt; dump memory /home/xxx/ test --force
</code></pre>
<p>After dumping for cpu or v8 heap, you can inspect the dump file via following steps:</p>
<ul>
<li>Open <a href="https://www.google.com/intl/en/chrome/browser/">google chrome</a> browser and press F12 to open the developer toolbar; </li>
<li>Go to <strong>Profiles</strong> tab, right-click in the tab pane and select <strong>Load profile...</strong>;</li>
<li>Select the dump file and click <strong>Open</strong>.</li>
</ul>
<p>For more detail about dump, you can visit <a href="https://github.com/piaohai/ndump">ndump</a>.</p>
</div>
</div></body></html>