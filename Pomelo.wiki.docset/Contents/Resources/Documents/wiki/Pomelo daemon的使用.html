<html><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
<meta charset="utf-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="en" http-equiv="Content-Language">
<meta content="width=1020" name="viewport">
<title>Pomelo daemon的使用 · NetEase/pomelo Wiki · GitHub</title>
<link href="/opensearch.xml" rel="search" title="GitHub" type="application/opensearchdescription+xml">
<link href="src/ad667adaa2cfe8f3caa4a41b7d0a79a1.png" rel="fluid-icon" title="GitHub">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="57x57">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="114x114">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="72x72">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="144x144">
<meta content="1401488693436528" property="fb:app_id">
<meta content="@github" name="twitter:site"/><meta content="summary" name="twitter:card"/><meta content="NetEase/pomelo" name="twitter:title"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="twitter:description"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" name="twitter:image:src"/>
<meta content="GitHub" property="og:site_name"/><meta content="object" property="og:type"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" property="og:image"/><meta content="NetEase/pomelo" property="og:title"/><meta content="https://github.com/NetEase/pomelo" property="og:url"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." property="og:description"/>
<meta content="https://api.github.com/_private/browser/stats" name="browser-stats-url">
<meta content="https://api.github.com/_private/browser/errors" name="browser-errors-url">
<link href="https://assets-cdn.github.com/" rel="assets">
<meta content="1000" name="pjax-timeout">
<meta content="/windows-tile.png" name="msapplication-TileImage">
<meta content="#ffffff" name="msapplication-TileColor">
<meta data-pjax-transient="" name="selected-link" value="repo_wiki">
<meta content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU" name="google-site-verification">
<meta content="UA-3769691-2" name="google-analytics">
<meta content="collector.githubapp.com" name="octolytics-host"/><meta content="github" name="octolytics-app-id"/><meta content="CA86616A:4489:F58970E:5670C091" name="octolytics-dimension-request_id"/>
<meta content="/&lt;user-name&gt;/&lt;repo-name&gt;/wiki/show" data-pjax-transient="true" name="analytics-location"/>
<meta content="Rails, view, wiki#show" data-pjax-transient="true" name="analytics-event"/>
<meta class="js-ga-set" content="Logged Out" name="dimension1">
<meta content="github.com" name="hostname">
<meta content="" name="user-login">
<meta content="github.com" name="expected-hostname">
<link color="#4078c0" href="https://assets-cdn.github.com/pinned-octocat.svg" rel="mask-icon">
<link href="https://assets-cdn.github.com/favicon.ico" rel="icon" type="image/x-icon">
<meta content="5020ba4812dd4208f676f20b6a099dd2a7694ff4" name="form-nonce"/>
<link crossorigin="anonymous" href="src/350888e1495e7af27e01faa9d8291dee.css" media="all" rel="stylesheet"/>
<link crossorigin="anonymous" href="src/9fae9b7d8f0785d745a43c6465f74ae5.css" media="all" rel="stylesheet"/>
<meta content="cd9958d45e48e8e3157a320e9c346eaa" http-equiv="x-pjax-version">
<meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="description">
<meta content="github.com/NetEase/pomelo git https://github.com/NetEase/pomelo.git" name="go-import">
<meta content="1460597" name="octolytics-dimension-user_id"/><meta content="NetEase" name="octolytics-dimension-user_login"/><meta content="5880912" name="octolytics-dimension-repository_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_nwo"/><meta content="true" name="octolytics-dimension-repository_public"/><meta content="false" name="octolytics-dimension-repository_is_fork"/><meta content="5880912" name="octolytics-dimension-repository_network_root_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_network_root_nwo"/>
<link href="https://github.com/NetEase/pomelo/commits/master.atom" rel="alternate" title="Recent Commits to pomelo:master" type="application/atom+xml">
</link></meta></meta></meta></link></link></meta></meta></meta></meta></meta></meta></meta></meta></meta></meta></link></meta></meta></meta></link></link></link></link></link></link></meta></meta></meta></meta></head><body style="padding:0 25px;"><div class="gollum-markdown-content instapaper_body" id="wiki-body">
<div class="markdown-body">
<h2>
<a aria-hidden="true" class="anchor" href="#pomelo-daemon" id="user-content-pomelo-daemon"><span class="octicon octicon-link"></span></a>pomelo-daemon</h2>
<p>pomelo-daemon 提供了一个 daemon 服务，可以用这个服务来进行分布式部署以及日志收集</p>
<h3>
<a aria-hidden="true" class="anchor" href="#%E5%AE%89%E8%A3%85" id="user-content-安装"><span class="octicon octicon-link"></span></a>安装</h3>
<pre><code>npm install -g pomelo-daemon
</code></pre>
<h3>
<a aria-hidden="true" class="anchor" href="#%E4%BD%BF%E7%94%A8" id="user-content-使用"><span class="octicon octicon-link"></span></a>使用</h3>
<h4>
<a aria-hidden="true" class="anchor" href="#%E5%90%AF%E5%8A%A8pomelo%E9%9B%86%E7%BE%A4" id="user-content-启动pomelo集群"><span class="octicon octicon-link"></span></a>启动pomelo集群</h4>
<ul>
<li>在服务器上面部署代码<br>
</br></li>
<li>把servers.json上面的host配置称为正确的host，而不是 '127.0.0.1'<br>
</br></li>
<li>在config文件夹下面添加daemon.json文件<br>
daemon.json 例子</br></li>
</ul>
<div class="highlight highlight-source-json"><pre>{
    <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>dh37fgj492je<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>key<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>agarxhqb98rpajloaxn34ga8xrunpagkjwlaw3ruxnpaagl29w4rxn<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>algorithm<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>sha256<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>pomelo<span class="pl-pds">"</span></span>
}</pre></div>
<p><strong>注意</strong>：pomelo-daemon 使用 <a href="https://github.com/hueniverse/hawk">hawk</a> 来提供服务间的请求认证  </p>
<ul>
<li>cd 到 /game-server 路径下面<br>
</br></li>
<li>在master服务器上，敲入命令<br>
</br></li>
</ul>
<pre><code>pomelo-daemon
</code></pre>
<ul>
<li>在其它服务器上，敲入命令<br>
</br></li>
</ul>
<pre><code>pomelo-daemon --mode=server
</code></pre>
<p><strong>注意</strong>：你可以使用nohup来部署daemon  </p>
<pre><code>nohup pomelo-daemon --mode=server
</code></pre>
<ul>
<li>在master服务器上，pomelo-daemon client，敲入命令<br>
</br></li>
</ul>
<pre><code>start all
</code></pre>
<ul>
<li>pomelo 集群启动起来了<br>
</br></li>
</ul>
<h4>
<a aria-hidden="true" class="anchor" href="#daemon-rpc-%E6%97%A5%E5%BF%97%E6%94%B6%E9%9B%86" id="user-content-daemon-rpc-日志收集"><span class="octicon octicon-link"></span></a>daemon rpc 日志收集</h4>
<p>pomelo-daemon 提供了 pomelo rpc 日志收集同步到 mongodb，然后可以通过 <a href="https://github.com/NetEase/pomelo-admin-web">pomelo-admin-web</a> 来进行分析查看  </p>
<ul>
<li>添加 mongo.json 文件到 config 文件夹下面<br>
mongo.json 例子<br>
</br></br></li>
</ul>
<div class="highlight highlight-source-json"><pre>{
    <span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>localhost<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span>: <span class="pl-c1">27017</span>,
    <span class="pl-s"><span class="pl-pds">"</span>username<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>pomelo<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>pomelo<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>database<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>test<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>collection<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>cpomelo<span class="pl-pds">"</span></span>
}</pre></div>
<ul>
<li>启动 pomelo-daemon rpc logger 收集，使用 --pattern 参数来设置 rpc-log 文件的patterns<br>
</br></li>
</ul>
<pre><code>pomelo-daemon --mode=server --log --pattern=rpc-log
</code></pre>
<p><strong>注意</strong>：rpc-logs 日志收集仅仅用于调试，在生产环境下面不建议使用rpc-logs模式  </p>
</div>
</div></body></html>