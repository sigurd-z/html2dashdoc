<html><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
<meta charset="utf-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="en" http-equiv="Content-Language">
<meta content="width=1020" name="viewport">
<title>Pomelo的分布式部署方法 · NetEase/pomelo Wiki · GitHub</title>
<link href="/opensearch.xml" rel="search" title="GitHub" type="application/opensearchdescription+xml">
<link href="src/ad667adaa2cfe8f3caa4a41b7d0a79a1.png" rel="fluid-icon" title="GitHub">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="57x57">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="114x114">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="72x72">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="144x144">
<meta content="1401488693436528" property="fb:app_id">
<meta content="@github" name="twitter:site"/><meta content="summary" name="twitter:card"/><meta content="NetEase/pomelo" name="twitter:title"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="twitter:description"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" name="twitter:image:src"/>
<meta content="GitHub" property="og:site_name"/><meta content="object" property="og:type"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" property="og:image"/><meta content="NetEase/pomelo" property="og:title"/><meta content="https://github.com/NetEase/pomelo" property="og:url"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." property="og:description"/>
<meta content="https://api.github.com/_private/browser/stats" name="browser-stats-url">
<meta content="https://api.github.com/_private/browser/errors" name="browser-errors-url">
<link href="https://assets-cdn.github.com/" rel="assets">
<meta content="1000" name="pjax-timeout">
<meta content="/windows-tile.png" name="msapplication-TileImage">
<meta content="#ffffff" name="msapplication-TileColor">
<meta data-pjax-transient="" name="selected-link" value="repo_wiki">
<meta content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU" name="google-site-verification">
<meta content="UA-3769691-2" name="google-analytics">
<meta content="collector.githubapp.com" name="octolytics-host"/><meta content="github" name="octolytics-app-id"/><meta content="CA86616A:2F46:EF6FB63:5670C108" name="octolytics-dimension-request_id"/>
<meta content="/&lt;user-name&gt;/&lt;repo-name&gt;/wiki/show" data-pjax-transient="true" name="analytics-location"/>
<meta content="Rails, view, wiki#show" data-pjax-transient="true" name="analytics-event"/>
<meta class="js-ga-set" content="Logged Out" name="dimension1">
<meta content="github.com" name="hostname">
<meta content="" name="user-login">
<meta content="github.com" name="expected-hostname">
<link color="#4078c0" href="https://assets-cdn.github.com/pinned-octocat.svg" rel="mask-icon">
<link href="https://assets-cdn.github.com/favicon.ico" rel="icon" type="image/x-icon">
<meta content="a30bf2112533f6bb28f762bf6ac42ca4d63af57c" name="form-nonce"/>
<link crossorigin="anonymous" href="src/350888e1495e7af27e01faa9d8291dee.css" media="all" rel="stylesheet"/>
<link crossorigin="anonymous" href="src/9fae9b7d8f0785d745a43c6465f74ae5.css" media="all" rel="stylesheet"/>
<meta content="cd9958d45e48e8e3157a320e9c346eaa" http-equiv="x-pjax-version">
<meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="description">
<meta content="github.com/NetEase/pomelo git https://github.com/NetEase/pomelo.git" name="go-import">
<meta content="1460597" name="octolytics-dimension-user_id"/><meta content="NetEase" name="octolytics-dimension-user_login"/><meta content="5880912" name="octolytics-dimension-repository_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_nwo"/><meta content="true" name="octolytics-dimension-repository_public"/><meta content="false" name="octolytics-dimension-repository_is_fork"/><meta content="5880912" name="octolytics-dimension-repository_network_root_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_network_root_nwo"/>
<link href="https://github.com/NetEase/pomelo/commits/master.atom" rel="alternate" title="Recent Commits to pomelo:master" type="application/atom+xml">
</link></meta></meta></meta></link></link></meta></meta></meta></meta></meta></meta></meta></meta></meta></meta></link></meta></meta></meta></link></link></link></link></link></link></meta></meta></meta></meta></head><body style="padding:0 25px;"><div class="gollum-markdown-content instapaper_body" id="wiki-body">
<div class="markdown-body">
<h1>
<a aria-hidden="true" class="anchor" href="#pomelo%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E9%83%A8%E7%BD%B2%E4%BB%A5lordofpomelo%E4%B8%BA%E4%BE%8B" id="user-content-pomelo的分布式部署以lordofpomelo为例"><span class="octicon octicon-link"></span></a>Pomelo的分布式部署(以LordOfPomelo为例)</h1>
<h3>
<a aria-hidden="true" class="anchor" href="#%E5%88%86%E5%B8%83%E5%BC%8F%E9%83%A8%E7%BD%B2%E7%9A%84%E6%96%B9%E6%B3%95%E5%92%8C%E6%AD%A5%E9%AA%A4" id="user-content-分布式部署的方法和步骤"><span class="octicon octicon-link"></span></a>分布式部署的方法和步骤</h3>
<h4>
<a aria-hidden="true" class="anchor" href="#1-%E7%B3%BB%E7%BB%9F%E5%8F%8A%E5%BA%94%E7%94%A8%E8%BD%AF%E4%BB%B6%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E5%92%8C%E9%85%8D%E7%BD%AE" id="user-content-1-系统及应用软件环境搭建和配置"><span class="octicon octicon-link"></span></a>1. 系统及应用软件环境搭建和配置</h4>
<p>所有参与分布式部署的机器: </p>
<ul>
<li>必须为同类操作系统(建议为完全相同的操作系统, 本文所示例的4台机器的操作系统均为"Debian GNU/Linux 7.0"). </li>
<li>必须都有一个同名的用户(如:"pomelo"等, 本文所示例的4台机器均有一个名为"pomelo"的用户).</li>
<li>Node.js的安装版本必须完全相同, 安装的<code>绝对路径</code>也必须完全相同(本文所示例的安装绝对路径为"/home/pomelo/node-v0.10.21-linux-x64").</li>
<li>"lordofpomelo"所放置的<code>绝对路径</code>也必须完全相同(本文所示例的绝对路径为"/home/pomelo/lordofpomelo").</li>
<li>在所有参与分布式部署的机器上配置<code>ssh登录选项</code>. 方法为: 在"~/.ssh"目录下创建一个名为"config"的文件(本文所示例的目录为"/home/pomelo/.ssh"), 文件内容如下:</li>
</ul>
<pre><code>Host *
HashKnownHosts no
CheckHostIP no
StrictHostKeyChecking no
</code></pre>
<p>上述文件的目的是使得各个机器之间可以进行顺畅的ssh登录. 各选项的含义请参考<a href="http://man.he.net/man5/ssh_config">ssh_config</a>.</p>
<h4>
<a aria-hidden="true" class="anchor" href="#2-%E5%85%A8%E5%B1%80%E5%AE%89%E8%A3%85pomelo-%E5%AE%89%E8%A3%85lordofpomelo%E4%BE%9D%E8%B5%96%E5%8C%85" id="user-content-2-全局安装pomelo-安装lordofpomelo依赖包"><span class="octicon octicon-link"></span></a>2. 全局安装Pomelo, 安装lordofpomelo依赖包</h4>
<pre><code>$ npm install pomelo -g
$ cd lordofpomelo
$ sh npm-install.sh
</code></pre>
<p>详细的步骤请参考<a href="https://github.com/NetEase/pomelo/wiki/%E5%AE%89%E8%A3%85pomelo">安装pomelo</a>和<a href="https://github.com/NetEase/pomelo/wiki/LordOfPomelo-%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97">LordOfPomelo-安装指南</a>.</p>
<h4>
<a aria-hidden="true" class="anchor" href="#3-%E4%BF%AE%E6%94%B9lordofpomelo%E4%B8%AD%E7%9B%B8%E5%85%B3%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6" id="user-content-3-修改lordofpomelo中相关配置文件"><span class="octicon octicon-link"></span></a>3. 修改lordofpomelo中相关配置文件</h4>
<ul>
<li>修改"lordofpomelo/shared/config/mysql.json": 将其中的<code>host</code>的地址修改为MySql所在机器的IP地址, 注意: 不要填写"127.0.0.1"或者"localhost". 具体的配置如下所示, 大家可以根据实际情况修改对应配置项:</li>
</ul>
<div class="highlight highlight-source-json"><pre>{
    <span class="pl-s"><span class="pl-pds">"</span>development<span class="pl-pds">"</span></span>: {
      <span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span> : <span class="pl-s"><span class="pl-pds">"</span>pomelo3.server.163.org<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span> : <span class="pl-s"><span class="pl-pds">"</span>3306<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>database<span class="pl-pds">"</span></span> : <span class="pl-s"><span class="pl-pds">"</span>Pomelo<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>user<span class="pl-pds">"</span></span> : <span class="pl-s"><span class="pl-pds">"</span>xy<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>password<span class="pl-pds">"</span></span> : <span class="pl-s"><span class="pl-pds">"</span>dev<span class="pl-pds">"</span></span>
    },
    <span class="pl-s"><span class="pl-pds">"</span>production<span class="pl-pds">"</span></span>: {
      <span class="pl-ii">...</span>
    }
}</pre></div>
<ul>
<li>修改"lordofpomelo/game-server/config/master.json":  将其中的<code>host</code>的地址修改为<code>master</code>所在机器的IP地址(即, 将要在哪台机器上使用<code>pomelo start</code>来启动<code>game-server</code>服务器集群), 注意: 不要填写"127.0.0.1"或者"localhost". 具体的配置如下所示, 大家可以根据实际情况修改对应配置项:</li>
</ul>
<div class="highlight highlight-source-json"><pre>{
    <span class="pl-s"><span class="pl-pds">"</span>development<span class="pl-pds">"</span></span>:{
        <span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>master-server-1<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>pomelo16.server.163.org<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span>: <span class="pl-c1">3005</span>
    },
    <span class="pl-s"><span class="pl-pds">"</span>production<span class="pl-pds">"</span></span>:
    {
        <span class="pl-ii">...</span>
    }   
}</pre></div>
<ul>
<li>修改"lordofpomelo/game-server/config/servers.json":  将其中的<code>host</code>的地址修改为相应服务进程所在机器的IP地址(即, 将要在哪台机器上运行该服务进程), 注意: 不要填写"127.0.0.1"或者"localhost". 具体的配置如下所示, 大家可以根据实际情况修改对应配置项:</li>
</ul>
<div class="highlight highlight-source-json"><pre>{
    <span class="pl-s"><span class="pl-pds">"</span>development<span class="pl-pds">"</span></span>: {
        <span class="pl-ii">...</span>
        <span class="pl-s"><span class="pl-pds">"</span>area<span class="pl-pds">"</span></span>: [
            {<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>area-server-1<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>pomelo16.server.163.org<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span>: <span class="pl-c1">3250</span>, <span class="pl-s"><span class="pl-pds">"</span>area<span class="pl-pds">"</span></span>: <span class="pl-c1">1</span>},
            {<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>area-server-2<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>pomelo18.server.163.org<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span>: <span class="pl-c1">3251</span>, <span class="pl-s"><span class="pl-pds">"</span>area<span class="pl-pds">"</span></span>: <span class="pl-c1">2</span>},
            {<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>area-server-3<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>pomelo19.server.163.org<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span>: <span class="pl-c1">3252</span>, <span class="pl-s"><span class="pl-pds">"</span>area<span class="pl-pds">"</span></span>: <span class="pl-c1">3</span>},
            <span class="pl-ii">...</span>
        ],
        <span class="pl-ii">...</span>
        <span class="pl-s"><span class="pl-pds">"</span>gate<span class="pl-pds">"</span></span>: [
            {<span class="pl-s"><span class="pl-pds">"</span>id<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>gate-server-1<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>pomelo16.server.163.org<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>clientPort<span class="pl-pds">"</span></span>: <span class="pl-c1">3014</span>, <span class="pl-s"><span class="pl-pds">"</span>frontend<span class="pl-pds">"</span></span>: <span class="pl-c1">true</span>}
        ],
        <span class="pl-ii">...</span>
    },
    <span class="pl-s"><span class="pl-pds">"</span>production<span class="pl-pds">"</span></span>: {
        <span class="pl-ii">...</span>
    }
}</pre></div>
<ul>
<li>修改"lordofpomelo/web-server/public/js/config/config.js":  将其中的<code>GATE_HOST</code>和<code>GATE_PORT</code>修改为<code>game-server的gate服务进程</code>所在机器的IP地址和端口, 注意: 如果<code>web-server</code>与<code>game-server的gate服务进程</code>在同一台机器上则可将<code>GATE_HOST</code>配置为<code>window.location.hostname</code>, 否则配置相应的IP; 该配置应与"lordofpomelo/game-server/config/servers.json"中<code>gate</code>的配置相对应. 具体的配置如下所示, 大家可以根据实际情况修改对应配置项:</li>
</ul>
<div class="highlight highlight-source-js"><pre>...
    IMAGE_URL<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>http://pomelo.netease.com/art/<span class="pl-pds">'</span></span>,
    GATE_HOST<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>pomelo16.server.163.org<span class="pl-pds">'</span></span>,
    GATE_PORT<span class="pl-k">:</span> <span class="pl-c1">3014</span>
...</pre></div>
<p>上述步骤都完成后就可以在<code>master</code>所在机器(本文所示例的是"pomelo16.server.163.org")的<code>lordofpomelo/game-server</code>目录下使用<code>pomelo start</code>命令启动<code>game-server</code>服务器集群; 在<code>lordofpomelo/game-server</code>目录下使用<code>pomelo stop</code>命令停止<code>game-server</code>服务器集群了. 在另外一台机器(本文所示例的是"pomelo17.server.163.org"; 当然也可以和上面的<code>master</code>在同一台机器上)的<code>lordofpomelo/web-server</code>目录下使用命令<code>node app.js</code>来启动<code>web-server</code>; 由于<code>web-server</code>是无状态的web服务器, 则可以通过<code>kill</code>/<code>Ctrl+c</code>来停止.</p>
<h4>
<a aria-hidden="true" class="anchor" href="#4-%E8%AF%B4%E6%98%8E" id="user-content-4-说明"><span class="octicon octicon-link"></span></a>4. 说明</h4>
<ul>
<li>在分布式部署中, 启动/停止各应用服务器的代码可以参考<code>lordofpomelo/game-server/node_modules/pomelo/lib/master/starter.js</code>中的<code>sshrun</code>函数相关部分.</li>
</ul>
</div>
</div></body></html>