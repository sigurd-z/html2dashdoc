<html><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
<meta charset="utf-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="en" http-equiv="Content-Language">
<meta content="width=1020" name="viewport">
<title>Application configuration · NetEase/pomelo Wiki · GitHub</title>
<link href="/opensearch.xml" rel="search" title="GitHub" type="application/opensearchdescription+xml">
<link href="src/ad667adaa2cfe8f3caa4a41b7d0a79a1.png" rel="fluid-icon" title="GitHub">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="57x57">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="114x114">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="72x72">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="144x144">
<meta content="1401488693436528" property="fb:app_id">
<meta content="@github" name="twitter:site"/><meta content="summary" name="twitter:card"/><meta content="NetEase/pomelo" name="twitter:title"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="twitter:description"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" name="twitter:image:src"/>
<meta content="GitHub" property="og:site_name"/><meta content="object" property="og:type"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" property="og:image"/><meta content="NetEase/pomelo" property="og:title"/><meta content="https://github.com/NetEase/pomelo" property="og:url"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." property="og:description"/>
<meta content="https://api.github.com/_private/browser/stats" name="browser-stats-url">
<meta content="https://api.github.com/_private/browser/errors" name="browser-errors-url">
<link href="https://assets-cdn.github.com/" rel="assets">
<meta content="1000" name="pjax-timeout">
<meta content="/windows-tile.png" name="msapplication-TileImage">
<meta content="#ffffff" name="msapplication-TileColor">
<meta data-pjax-transient="" name="selected-link" value="repo_wiki">
<meta content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU" name="google-site-verification">
<meta content="UA-3769691-2" name="google-analytics">
<meta content="collector.githubapp.com" name="octolytics-host"/><meta content="github" name="octolytics-app-id"/><meta content="7250A4CA:6925:144B1A6B:5670BFB1" name="octolytics-dimension-request_id"/>
<meta content="/&lt;user-name&gt;/&lt;repo-name&gt;/wiki/show" data-pjax-transient="true" name="analytics-location"/>
<meta content="Rails, view, wiki#show" data-pjax-transient="true" name="analytics-event"/>
<meta class="js-ga-set" content="Logged Out" name="dimension1">
<meta content="github.com" name="hostname">
<meta content="" name="user-login">
<meta content="github.com" name="expected-hostname">
<link color="#4078c0" href="https://assets-cdn.github.com/pinned-octocat.svg" rel="mask-icon">
<link href="https://assets-cdn.github.com/favicon.ico" rel="icon" type="image/x-icon">
<meta content="d58c7fea38592cc55a477dc4c635079f253358d4" name="form-nonce"/>
<link crossorigin="anonymous" href="src/350888e1495e7af27e01faa9d8291dee.css" media="all" rel="stylesheet"/>
<link crossorigin="anonymous" href="src/9fae9b7d8f0785d745a43c6465f74ae5.css" media="all" rel="stylesheet"/>
<meta content="cd9958d45e48e8e3157a320e9c346eaa" http-equiv="x-pjax-version">
<meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="description">
<meta content="github.com/NetEase/pomelo git https://github.com/NetEase/pomelo.git" name="go-import">
<meta content="1460597" name="octolytics-dimension-user_id"/><meta content="NetEase" name="octolytics-dimension-user_login"/><meta content="5880912" name="octolytics-dimension-repository_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_nwo"/><meta content="true" name="octolytics-dimension-repository_public"/><meta content="false" name="octolytics-dimension-repository_is_fork"/><meta content="5880912" name="octolytics-dimension-repository_network_root_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_network_root_nwo"/>
<link href="https://github.com/NetEase/pomelo/commits/master.atom" rel="alternate" title="Recent Commits to pomelo:master" type="application/atom+xml">
</link></meta></meta></meta></link></link></meta></meta></meta></meta></meta></meta></meta></meta></meta></meta></link></meta></meta></meta></link></link></link></link></link></link></meta></meta></meta></meta></head><body style="padding:0 25px;"><div class="gollum-markdown-content instapaper_body" id="wiki-body">
<div class="markdown-body">
<p>This document introduces how to configure the pomelo framework. As we know, we can configure options for each component, load the configuration file, enable/disable pomelo features to configure the pomelo framework, and all these are placed in game-server/app.js. </p>
<h1>
<a aria-hidden="true" class="anchor" href="#appjs-file-" id="user-content-appjs-file-"><span class="octicon octicon-link"></span></a>app.js File </h1>
<p>app.js is the entrance of project based on pomelo. In app.js, it firstly creates an instance <strong>app</strong> of class Application, and then uses this app as context of the framework. Developers can mount some global variables or load some configuration to this context, developers can also do some other initializing and configuration operations for the app. At last, it starts the project by call app.start(). The main content of a general app.js is shown as follows:</p>
<div class="highlight highlight-source-js"><pre>
<span class="pl-k">var</span> pomelo <span class="pl-k">=</span> <span class="pl-c1">require</span> (<span class="pl-s"><span class="pl-pds">'</span>pomelo<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> app <span class="pl-k">=</span> <span class="pl-smi">pomelo</span>.<span class="pl-en">createApp</span>();

<span class="pl-c">// some configurating operation for app.</span>

<span class="pl-smi">app</span>.<span class="pl-en">configure</span>(<span class="pl-k">&lt;</span>env<span class="pl-k">&gt;</span>, <span class="pl-k">&lt;</span>serverType<span class="pl-k">&gt;</span>, <span class="pl-k">function</span>() {
   <span class="pl-c">// ... </span>
});

<span class="pl-smi">app</span>.<span class="pl-en">configure</span> (....);
<span class="pl-smi">app</span>.<span class="pl-en">set</span> (...);
<span class="pl-smi">app</span>.<span class="pl-en">route</span> (...);

<span class="pl-c">// ...</span>

<span class="pl-c">// start app</span>
<span class="pl-smi">app</span>.<span class="pl-c1">start</span> ();
</pre></div>
<h1>
<a aria-hidden="true" class="anchor" href="#appconfigure-" id="user-content-appconfigure-"><span class="octicon octicon-link"></span></a>app.configure() </h1>
<p>Configuration on servers is always by calling app.configure() method, whose signature is presented as follows: </p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">app</span>.<span class="pl-en">configure</span>([env], [serverType], [<span class="pl-k">function</span>]);</pre></div>
<p>The parameter env and serverType are optional, all the parameters are explained as follows:</p>
<ul>
<li>env: runtime environment, it can be set to development, production or development|production;</li>
<li>serverType: target server type, if this parameter is set to T, then only servers whose type is T do configuration logic, otherwise, all the servers do configuration logics.</li>
<li>function: it is required and is used to holds the configuration logic for servers.</li>
</ul>
<p>Here are some configuration examples :</p>
<h4>
<a aria-hidden="true" class="anchor" href="#example-i" id="user-content-example-i"><span class="octicon octicon-link"></span></a>Example I</h4>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">app</span>.<span class="pl-en">configure</span> (<span class="pl-k">function</span>() {
  <span class="pl-c">// Do some configuration</span>
});</pre></div>
<p>This configuration will affect on all the environment(development or production) for all servers, which is equivalent to directly write configuration code in app.js, code examples are as follows:</p>
<div class="highlight highlight-source-js"><pre>
<span class="pl-smi">app</span>.<span class="pl-en">configure</span> (<span class="pl-k">function</span> () {
  <span class="pl-en">doSomeConfiguration</span> ();
});

<span class="pl-c">// &lt;==&gt;</span>

<span class="pl-en">doSomeConfiguration</span>(); <span class="pl-c">// equivalent to above `app.configure`</span>
</pre></div>
<h4>
<a aria-hidden="true" class="anchor" href="#example-ii" id="user-content-example-ii"><span class="octicon octicon-link"></span></a>Example II</h4>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">app</span>.<span class="pl-en">configure</span> (<span class="pl-s"><span class="pl-pds">'</span>development<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-c">// Do some configuration just for development env only.</span>
});</pre></div>
<p>This configuration will affect all the servers that is in development environment. </p>
<h4>
<a aria-hidden="true" class="anchor" href="#example-iii" id="user-content-example-iii"><span class="octicon octicon-link"></span></a>Example III</h4>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">app</span>.<span class="pl-en">configure</span> (<span class="pl-s"><span class="pl-pds">'</span>development<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>chat<span class="pl-pds">'</span></span>, <span class="pl-k">function</span> () {
  <span class="pl-c">// Do some configuration just for development env and chat server only.</span>
});</pre></div>
<p>This configuration will only affect the chat servers in development environment.</p>
<h4>
<a aria-hidden="true" class="anchor" href="#configuration-logic" id="user-content-configuration-logic"><span class="octicon octicon-link"></span></a>Configuration Logic</h4>
<p>Developers can make different configuration for different servers to meet the server's demands. for example, loading mysql configuration for all the servers: </p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">app</span>.<span class="pl-en">configure</span> (<span class="pl-s"><span class="pl-pds">'</span>development|production<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-smi">app</span>.<span class="pl-en">loadConfig</span> (<span class="pl-s"><span class="pl-pds">'</span>mysql<span class="pl-pds">'</span></span>, <span class="pl-smi">app</span>.<span class="pl-en">getBase</span>() <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">'</span>/config/mysql.json<span class="pl-pds">'</span></span>);
});</pre></div>
<p>It can also do some configuration on specific servers, for example, doing some initialization for area servers:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> <span class="pl-en">initArea</span> <span class="pl-k">=</span> <span class="pl-k">function</span> () {
  <span class="pl-c">// area server initialization</span>
};

<span class="pl-smi">app</span>.<span class="pl-en">configure</span>(<span class="pl-s"><span class="pl-pds">'</span>development|production<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>area<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-en">initArea</span> ();
});
</pre></div>
<p>It can do any configurations on any servers in any environments. These configurations include setting a variable to context of the framework that can be used anywhere, enable/disable some features of pomelo, setting options for builtin components, configuring the filter for a specific server, etc.. An example is shown as follows:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">app</span>.<span class="pl-en">configure</span>(<span class="pl-s"><span class="pl-pds">'</span>development|production<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>chat<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-smi">app</span>.<span class="pl-en">route</span> (<span class="pl-s"><span class="pl-pds">'</span>chat<span class="pl-pds">'</span></span>, <span class="pl-smi">routeUtil</span>.<span class="pl-smi">chat</span>); <span class="pl-c">// configure route</span>
});

<span class="pl-smi">app</span>.<span class="pl-en">enable</span>(<span class="pl-s"><span class="pl-pds">'</span>systemMonitor<span class="pl-pds">'</span></span>); <span class="pl-c">// enable feature</span>

<span class="pl-smi">app</span>.<span class="pl-en">configure</span> (<span class="pl-s"><span class="pl-pds">'</span>development|production<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>gate<span class="pl-pds">'</span></span>, <span class="pl-k">function</span>() {
  <span class="pl-smi">app</span>.<span class="pl-en">set</span> (<span class="pl-s"><span class="pl-pds">'</span>connectorConfig<span class="pl-pds">'</span></span>, {
    connector<span class="pl-k">:</span> <span class="pl-smi">pomelo</span>.<span class="pl-smi">connectors</span>.<span class="pl-smi">hybridconnector</span>,
    heartbeat<span class="pl-k">:</span> <span class="pl-c1">3</span>
  }); <span class="pl-c">// configure opts for connector component</span>
}); <span class="pl-c">// configure connector for gate server</span></pre></div>
<h1>
<a aria-hidden="true" class="anchor" href="#accessing-context-variable-" id="user-content-accessing-context-variable-"><span class="octicon octicon-link"></span></a>Accessing Context Variable </h1>
<p>The app instance has getter/setter for context variables:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">app</span>.<span class="pl-en">set</span>(name, value, [isAttach]);
<span class="pl-smi">app</span>.<span class="pl-en">get</span>(name);</pre></div>
<ul>
<li>For setter, there are three parameters: variable name , variable value and an optional parameter isAttach. If isAttach is set to true, the variable will be attached to app instance as a property of app. The default for isAttach is false if omitted.</li>
<li>For getter, it is very simple to obtain a variable value by its name.</li>
</ul>
<p>Example code is presented as follows:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">app</span>.<span class="pl-en">set</span>(<span class="pl-s"><span class="pl-pds">'</span>server<span class="pl-pds">'</span></span>, server);
<span class="pl-k">var</span> server <span class="pl-k">=</span> <span class="pl-smi">app</span>.<span class="pl-en">get</span> (<span class="pl-s"><span class="pl-pds">'</span>server<span class="pl-pds">'</span></span>);

<span class="pl-smi">app</span>.<span class="pl-en">set</span>(<span class="pl-s"><span class="pl-pds">'</span>service<span class="pl-pds">'</span></span>, service, <span class="pl-c1">true</span>);
<span class="pl-k">var</span> service <span class="pl-k">=</span> <span class="pl-smi">app</span>.<span class="pl-smi">service</span>;</pre></div>
<p>In pomelo framework, developers can set options for builtin components of pomelo by app.set. Also, the builtin service such as backendSessionService, channelService provided by pomelo framework can be obtained by app.get, example code is presented as follows:</p>
<div class="highlight highlight-source-js"><pre>
<span class="pl-smi">app</span>.<span class="pl-en">set</span> (<span class="pl-s"><span class="pl-pds">'</span>connectorConfig<span class="pl-pds">'</span></span>, {
  <span class="pl-c">// ...</span>
}); <span class="pl-c">// set options for connector component</span>

<span class="pl-k">var</span> backendSessionService <span class="pl-k">=</span> <span class="pl-smi">app</span>.<span class="pl-en">get</span> (<span class="pl-s"><span class="pl-pds">'</span>backendSessionService<span class="pl-pds">'</span></span>); <span class="pl-c">// get backendSessionService instance</span></pre></div>
<p>Developers can also set some customized variables into app, and access them anywhere by app.get.</p>
<h1>
<a aria-hidden="true" class="anchor" href="#disablingenabling-features" id="user-content-disablingenabling-features"><span class="octicon octicon-link"></span></a>Disabling/Enabling Features</h1>
<p>Some features of pomelo can be enabled and disabled. Developer can check status of a feature by enabled and disabled method. For example, to disable and enable rpc debug log feature and check its status, the sample code is shown as follows:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">app</span>.<span class="pl-en">enable</span> (<span class="pl-s"><span class="pl-pds">'</span>rpcDebugLog<span class="pl-pds">'</span></span>);
<span class="pl-smi">app</span>.<span class="pl-en">enabled</span> (<span class="pl-s"><span class="pl-pds">'</span>rpcDebugLog<span class="pl-pds">'</span></span>); <span class="pl-c">// return true</span>
<span class="pl-smi">app</span>.<span class="pl-en">disable</span> (<span class="pl-s"><span class="pl-pds">'</span>rpcDebugLog<span class="pl-pds">'</span></span>);
<span class="pl-smi">app</span>.<span class="pl-c1">disabled</span> (<span class="pl-s"><span class="pl-pds">'</span>rpcDebugLog<span class="pl-pds">'</span></span>); <span class="pl-c">// return true</span></pre></div>
<p>In pomelo framework, when it is required to do more detailed monitoring and management, you can enable systemMonitor feature to load additional Modules, sample code is shown as follows:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">app</span>.<span class="pl-en">enable</span> (<span class="pl-s"><span class="pl-pds">'</span>systemMonitor<span class="pl-pds">'</span></span>); <span class="pl-c">// enable system monitor</span></pre></div>
<p>Developers can also make a feature for pomelo that cant be disabled/enabled by app.disable/app.enable and checked by app.enabled/app.disabled.</p>
<h1>
<a aria-hidden="true" class="anchor" href="#loading-configuration-file-" id="user-content-loading-configuration-file-"><span class="octicon octicon-link"></span></a>Loading Configuration File </h1>
<p>Developers can load configuration file by app.loadConfig, and the configuration information will be mounted directly to app object. For example, loading mysql.json file which should be placed in game-server/config directory, the following is sample code:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-c">// mysql.json</span>
{
  <span class="pl-s"><span class="pl-pds">"</span>development<span class="pl-pds">"</span></span><span class="pl-k">:</span>
  {
    <span class="pl-s"><span class="pl-pds">"</span>host<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>127.0.0.1<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>port<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>3306<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>database<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>pomelo<span class="pl-pds">"</span></span>
  }
}

<span class="pl-c">// app.js</span>
<span class="pl-smi">app</span>.<span class="pl-en">loadConfig</span>(<span class="pl-s"><span class="pl-pds">'</span>mysql.json<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> host <span class="pl-k">=</span> <span class="pl-smi">app</span>.<span class="pl-smi">mysql</span>.<span class="pl-c1">host</span>; <span class="pl-c">// return 127.0.0.1</span>
</pre></div>
<p>Of course, Developers can use app.loadConfig to load any json-formatted configuraton file which is placed in game-server/config directory for any purposes.</p>
<h1>
<a aria-hidden="true" class="anchor" href="#loading-component" id="user-content-loading-component"><span class="octicon octicon-link"></span></a>Loading Component</h1>
<p>The functionalities of pomelo is provided by its loaded components, pomelo would load different builtin components by default based on the type of server, and developers can implement a customized component and then load it to pomelo manually. Loading a component uses app.load, sample code is as follows:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">app</span>.<span class="pl-c1">load</span>(HelloWorldComponent, [opts]); <span class="pl-c">// opts is optional</span></pre></div>
<h1>
<a aria-hidden="true" class="anchor" href="#using-plugin" id="user-content-using-plugin"><span class="octicon octicon-link"></span></a>Using Plugin</h1>
<p>pomelo can also use a customized plugin, a plugin is composed of multiple components and event handlers for responding to events emitted by application, Using a plugin uses app.use, sample code is as follows:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-c">// app.use (&lt;plugin&gt;, &lt;plugin options&gt;);</span>

<span class="pl-k">var</span> statusPlugin <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>pomelo-status-plugin<span class="pl-pds">'</span></span>);

<span class="pl-smi">app</span>.<span class="pl-en">use</span>(statusPlugin, {
  status<span class="pl-k">:</span> {
    host<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>127 .0.0.1 <span class="pl-pds">'</span></span>,
    port<span class="pl-k">:</span> <span class="pl-c1">6379</span>
  }
});</pre></div>
<h1>
<a aria-hidden="true" class="anchor" href="#configuring-router" id="user-content-configuring-router"><span class="octicon octicon-link"></span></a>Configuring Router</h1>
<p>Router is used to calculate the target server for requests from clients. Developers can customize the routing policies for the different servers and then configure it on the servers. The following is an example:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-c">// routeUtil.js</span>
<span class="pl-smi">app</span>.<span class="pl-en">route</span>(<span class="pl-s"><span class="pl-pds">'</span>chat<span class="pl-pds">'</span></span>, <span class="pl-smi">routeUtil</span>.<span class="pl-smi">chat</span>);</pre></div>
<p>Routing policy can be defined in routerUtil, for example:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-c1">routeUtil</span>.<span class="pl-en">chat</span> <span class="pl-k">=</span> <span class="pl-k">function</span>(<span class="pl-smi">session</span>, <span class="pl-smi">msg</span>, <span class="pl-smi">app</span>, <span class="pl-smi">callback</span>) {
  <span class="pl-k">var</span> chatServers <span class="pl-k">=</span> <span class="pl-smi">app</span>.<span class="pl-en">getServersByType</span>(<span class="pl-s"><span class="pl-pds">'</span>chat<span class="pl-pds">'</span></span>);
  <span class="pl-k">if</span> (<span class="pl-k">!</span>chatServers) {
    <span class="pl-en">callback</span> (<span class="pl-k">new</span> <span class="pl-en">Error</span> (<span class="pl-s"><span class="pl-pds">'</span>can not find chat servers.<span class="pl-pds">'</span></span>));
    <span class="pl-k">return</span>;
  }
  <span class="pl-k">var</span> server <span class="pl-k">=</span> <span class="pl-smi">dispatcher</span>.<span class="pl-en">dispatch</span> (<span class="pl-smi">session</span>.<span class="pl-smi">rid</span>, chatServers);
  <span class="pl-en">callback</span> (<span class="pl-c1">null</span>, <span class="pl-smi">server</span>.<span class="pl-c1">id</span>);
};</pre></div>
<p>In the routing function, The target server id is returned through calling the callback function as an argument. </p>
<h1>
<a aria-hidden="true" class="anchor" href="#configuring-filter" id="user-content-configuring-filter"><span class="octicon octicon-link"></span></a>Configuring Filter</h1>
<p>When a request from a client arrives at server, it will be handled by filter-chain and handler. Handler is where the business logic works, and it will do some pre and post-handling for business logic in filters. In order to facilitate developers, pomelo provides a number of builtin filter such as serialFilter, timeFilter, timeOutFilter. Developers can customize their own filter according to certain requirement. The following example shows how to configure a filter:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-smi">app</span>.<span class="pl-en">filter</span>(<span class="pl-smi">pomelo</span>.<span class="pl-smi">filters</span>.<span class="pl-en">serial</span>()); <span class="pl-c">// configure builtin filter: serialFilter</span>

<span class="pl-smi">app</span>.<span class="pl-en">filter</span>(FooFilter); <span class="pl-c">// configure FooFilter as a before &amp; after filter</span>

<span class="pl-smi">app</span>.<span class="pl-en">before</span>(beforeFilter); <span class="pl-c">// configure beforeFilter only as a before filter</span>

<span class="pl-smi">app</span>.<span class="pl-en">after</span>(afterFilter); <span class="pl-c">// configure afterFilter only as an after filter</span></pre></div>
<p>If the filter is only a before filter, then use app.before method; If the filter is only an after filter, then app.after instead. If the filter is both a before filter and an after filter, app.filter method works.</p>
<h1>
<a aria-hidden="true" class="anchor" href="#registering-module" id="user-content-registering-module"><span class="octicon octicon-link"></span></a>Registering Module</h1>
<p>Pomelo provides monitoring and management framework which can be registered by different Modules for different purposes. Registering a Module uses app.registerAdmin, sample code is shown as follows:</p>
<div class="highlight highlight-source-js"><pre>  <span class="pl-smi">app</span>.<span class="pl-en">registerAdmin</span> (<span class="pl-c1">require</span> (<span class="pl-s"><span class="pl-pds">'</span>../modules/watchdog<span class="pl-pds">'</span></span>), {app<span class="pl-k">:</span> app, master<span class="pl-k">:</span> <span class="pl-c1">true</span>});</pre></div>
<p>Developers can also customize their own Module, and then register it to the framework by calling app.registerAdmin.</p>
<h1>
<a aria-hidden="true" class="anchor" href="#configuration-file-for-servers-" id="user-content-configuration-file-for-servers-"><span class="octicon octicon-link"></span></a>Configuration File for Servers </h1>
<p>There are many configuration files placed in game-server/config directory, among them there are two very important configuration file for serves: servers.json and master.json.</p>
<p>Every configuration file includes two environment configurations: development and production. Their configuration item are list as follows:</p>
<p>For master.json:</p>
<ul>
<li>id: server id of master server, it is a string ;</li>
<li>host: host of master indicates where to launch a master server, it can be a domain name or ip;</li>
<li>port: the listening port for master server, the default is 3005 ;</li>
<li>args: optional, it is used for node/v8, for example you can configure <code>"args": "--debug=5858 "</code> and then you can debug your project.</li>
</ul>
<p>For servers.json:</p>
<ul>
<li>id: server id of application server, it is a string;</li>
<li>Host: same as master server but for application server here;</li>
<li>port: listening port for RPC requests;</li>
<li>frontend: it is a boolean value, for frontend server, it must be set to true. If omitted, the default is false. It should not be configured for backend servers; </li>
<li>clientPort: listening port for requests from clients for the frontend servers. It should not be configured for backend servers;</li>
<li>max-connections: optional, it is used to describe maximum connections that frontend servers can hold. It should not be configured for backend servers too;</li>
<li>args: optional, same as master server;</li>
<li>cpu: set cpu affinity for server process, it depends on <strong>taskset</strong> and only works on unix-like platform.</li>
</ul>
</div>
</div></body></html>