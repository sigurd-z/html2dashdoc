<html><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
<meta charset="utf-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="en" http-equiv="Content-Language">
<meta content="width=1020" name="viewport">
<title>Pomelo startup procedure · NetEase/pomelo Wiki · GitHub</title>
<link href="/opensearch.xml" rel="search" title="GitHub" type="application/opensearchdescription+xml">
<link href="src/ad667adaa2cfe8f3caa4a41b7d0a79a1.png" rel="fluid-icon" title="GitHub">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="57x57">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="114x114">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="72x72">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="144x144">
<meta content="1401488693436528" property="fb:app_id">
<meta content="@github" name="twitter:site"/><meta content="summary" name="twitter:card"/><meta content="NetEase/pomelo" name="twitter:title"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="twitter:description"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" name="twitter:image:src"/>
<meta content="GitHub" property="og:site_name"/><meta content="object" property="og:type"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" property="og:image"/><meta content="NetEase/pomelo" property="og:title"/><meta content="https://github.com/NetEase/pomelo" property="og:url"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." property="og:description"/>
<meta content="https://api.github.com/_private/browser/stats" name="browser-stats-url">
<meta content="https://api.github.com/_private/browser/errors" name="browser-errors-url">
<link href="https://assets-cdn.github.com/" rel="assets">
<meta content="1000" name="pjax-timeout">
<meta content="/windows-tile.png" name="msapplication-TileImage">
<meta content="#ffffff" name="msapplication-TileColor">
<meta data-pjax-transient="" name="selected-link" value="repo_wiki">
<meta content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU" name="google-site-verification">
<meta content="UA-3769691-2" name="google-analytics">
<meta content="collector.githubapp.com" name="octolytics-host"/><meta content="github" name="octolytics-app-id"/><meta content="CA86616A:2F44:144961D8:5670C0BD" name="octolytics-dimension-request_id"/>
<meta content="/&lt;user-name&gt;/&lt;repo-name&gt;/wiki/show" data-pjax-transient="true" name="analytics-location"/>
<meta content="Rails, view, wiki#show" data-pjax-transient="true" name="analytics-event"/>
<meta class="js-ga-set" content="Logged Out" name="dimension1">
<meta content="github.com" name="hostname">
<meta content="" name="user-login">
<meta content="github.com" name="expected-hostname">
<link color="#4078c0" href="https://assets-cdn.github.com/pinned-octocat.svg" rel="mask-icon">
<link href="https://assets-cdn.github.com/favicon.ico" rel="icon" type="image/x-icon">
<meta content="ede0bc037748046adc2562d022f879aac20e9834" name="form-nonce"/>
<link crossorigin="anonymous" href="src/350888e1495e7af27e01faa9d8291dee.css" media="all" rel="stylesheet"/>
<link crossorigin="anonymous" href="src/9fae9b7d8f0785d745a43c6465f74ae5.css" media="all" rel="stylesheet"/>
<meta content="cd9958d45e48e8e3157a320e9c346eaa" http-equiv="x-pjax-version">
<meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="description">
<meta content="github.com/NetEase/pomelo git https://github.com/NetEase/pomelo.git" name="go-import">
<meta content="1460597" name="octolytics-dimension-user_id"/><meta content="NetEase" name="octolytics-dimension-user_login"/><meta content="5880912" name="octolytics-dimension-repository_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_nwo"/><meta content="true" name="octolytics-dimension-repository_public"/><meta content="false" name="octolytics-dimension-repository_is_fork"/><meta content="5880912" name="octolytics-dimension-repository_network_root_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_network_root_nwo"/>
<link href="https://github.com/NetEase/pomelo/commits/master.atom" rel="alternate" title="Recent Commits to pomelo:master" type="application/atom+xml">
</link></meta></meta></meta></link></link></meta></meta></meta></meta></meta></meta></meta></meta></meta></meta></link></meta></meta></meta></link></link></link></link></link></link></meta></meta></meta></meta></head><body style="padding:0 25px;"><div class="gollum-markdown-content instapaper_body" id="wiki-body">
<div class="markdown-body">
<h2>
<a aria-hidden="true" class="anchor" href="#overview-of-startup-procedure" id="user-content-overview-of-startup-procedure"><span class="octicon octicon-link"></span></a>Overview of startup procedure</h2>
<p>The startup model diagram of Pomelo is as follow:</p>
<p><img alt="start_model" data-canonical-src="http://pomelo.netease.com/resource/documentImage/start_model.png" src="https://camo.githubusercontent.com/5e2819755651743710be78547da919109291801f/687474703a2f2f706f6d656c6f2e6e6574656173652e636f6d2f7265736f757263652f646f63756d656e74496d6167652f73746172745f6d6f64656c2e706e67"/></p>
<h2>
<a aria-hidden="true" class="anchor" href="#startup-entrance" id="user-content-startup-entrance"><span class="octicon octicon-link"></span></a>Startup Entrance</h2>
<p>The file app.js in game-server directory is the entrance of the project which you develop with pomelo. The startup code in app.js is as follow:</p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> pomelo <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>pomelo<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> app <span class="pl-k">=</span> <span class="pl-smi">pomelo</span>.<span class="pl-en">createApp</span>();
<span class="pl-smi">app</span>.<span class="pl-en">set</span>(<span class="pl-s"><span class="pl-pds">'</span>name<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>nameofproject<span class="pl-pds">'</span></span>);
<span class="pl-smi">app</span>.<span class="pl-en">defaultConfiguration</span>();
<span class="pl-smi">app</span>.<span class="pl-c1">start</span>();</pre></div>
<p>Firstly, it creates an application using pomelo; then it sets the application name. After that it makes default configuration of pomelo. These configurations are necessary environments to create a pomelo project, and finally you can start the application. When app.js is running, pomelo will start different components and servers according to the configurations of the application.</p>
<h3>
<a aria-hidden="true" class="anchor" href="#servers-and-components-startup" id="user-content-servers-and-components-startup"><span class="octicon octicon-link"></span></a>Servers and components startup</h3>
<p>After starting the application, it first loads components, including handler, filter, master, monitor, proxy, remote, server, sync, connection. Component is the bridge between pomelo and dependencies of pomelo, different servers load different components; developer can load different components based on different requirements of the application, furthermore, developers can customize their own components.</p>
<p>Component also has its life cycle, including before start, start, after start, stop etc. Developers can implement these methods in component and server launch corresponding methods at different life time of component.</p>
<p>Master server will first load master component, and master server is started by the master component. When the master component is started, it loads the adminConsole module. Then it starts all other servers according to user configuration file servers.json and parameters received by the master server. All servers start from app.js, load corresponding components, and launch at last.</p>
<h2>
<a aria-hidden="true" class="anchor" href="#detail-of-startup-procedure" id="user-content-detail-of-startup-procedure"><span class="octicon octicon-link"></span></a>Detail of startup procedure</h2>
<h2>
<a aria-hidden="true" class="anchor" href="#application-initiation-and-startup" id="user-content-application-initiation-and-startup"><span class="octicon octicon-link"></span></a>Application initiation and startup</h2>
<p>All servers are started from app.js. And each server creates an application object in its process after starting, and all server information is attached in this object, which includes server physical information, server logic information and pomelo components information. Moreover, this objects provide management and configuration methods of application. After invoking app.start() method in app.js, application object loads default components using loadDefaultComponents method.</p>
<h2>
<a aria-hidden="true" class="anchor" href="#load-components" id="user-content-load-components"><span class="octicon octicon-link"></span></a>Load components</h2>
<p>When loading components, different servers load different components according to the information of its server type. For example, the framework loads master component and monitor component for master server, and loads proxy, filter, handler and server components for other servers in default. It may load special component in certain server, for example, frontend servers load connection component, and backend servers load remote component, default components are described as follows:</p>
<ul>
<li>master: starting the master server.</li>
<li>monitor: starting each server's monitor service, the service is in charge of collecting information of servers and regularly pushing messages to the master, maintaining the master server's heartbeat connection.</li>
<li>proxy: generating server RPC client, which is essential for server processes comuniation(except master server).</li>
<li>handler: loading handlers in front-end server.</li>
<li>filter: loading filters for requests service, including filters before and after the calling of rpc.</li>
<li>remote: loading the back-end servers, and generates rpc server.</li>
<li>server: starting service of user requests handling in all servers.</li>
<li>connector: starting session service in front-end servers and receiving user requests.</li>
<li>sync: starting data synchronization service and provide external data synchronization service.</li>
<li>connection: starting the service of user connection statistical data.</li>
</ul>
<p>Components loading diagram is as follow：</p>
<p><img alt="components_load" data-canonical-src="http://pomelo.netease.com/resource/documentImage/components_load.png" src="https://camo.githubusercontent.com/fd833b788c4d0f211aed0abd4dd631feed3dacde/687474703a2f2f706f6d656c6f2e6e6574656173652e636f6d2f7265736f757263652f646f63756d656e74496d6167652f636f6d706f6e656e74735f6c6f61642e706e67"/></p>
</div>
</div></body></html>