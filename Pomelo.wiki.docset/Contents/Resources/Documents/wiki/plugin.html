<html><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
<meta charset="utf-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="en" http-equiv="Content-Language">
<meta content="width=1020" name="viewport">
<title>plugin · NetEase/pomelo Wiki · GitHub</title>
<link href="/opensearch.xml" rel="search" title="GitHub" type="application/opensearchdescription+xml">
<link href="src/ad667adaa2cfe8f3caa4a41b7d0a79a1.png" rel="fluid-icon" title="GitHub">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="57x57">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="114x114">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="72x72">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="144x144">
<meta content="1401488693436528" property="fb:app_id">
<meta content="@github" name="twitter:site"/><meta content="summary" name="twitter:card"/><meta content="NetEase/pomelo" name="twitter:title"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="twitter:description"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" name="twitter:image:src"/>
<meta content="GitHub" property="og:site_name"/><meta content="object" property="og:type"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" property="og:image"/><meta content="NetEase/pomelo" property="og:title"/><meta content="https://github.com/NetEase/pomelo" property="og:url"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." property="og:description"/>
<meta content="https://api.github.com/_private/browser/stats" name="browser-stats-url">
<meta content="https://api.github.com/_private/browser/errors" name="browser-errors-url">
<link href="https://assets-cdn.github.com/" rel="assets">
<meta content="1000" name="pjax-timeout">
<meta content="/windows-tile.png" name="msapplication-TileImage">
<meta content="#ffffff" name="msapplication-TileColor">
<meta data-pjax-transient="" name="selected-link" value="repo_wiki">
<meta content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU" name="google-site-verification">
<meta content="UA-3769691-2" name="google-analytics">
<meta content="collector.githubapp.com" name="octolytics-host"/><meta content="github" name="octolytics-app-id"/><meta content="CA86616A:448A:12092825:5670C05D" name="octolytics-dimension-request_id"/>
<meta content="/&lt;user-name&gt;/&lt;repo-name&gt;/wiki/show" data-pjax-transient="true" name="analytics-location"/>
<meta content="Rails, view, wiki#show" data-pjax-transient="true" name="analytics-event"/>
<meta class="js-ga-set" content="Logged Out" name="dimension1">
<meta content="github.com" name="hostname">
<meta content="" name="user-login">
<meta content="github.com" name="expected-hostname">
<link color="#4078c0" href="https://assets-cdn.github.com/pinned-octocat.svg" rel="mask-icon">
<link href="https://assets-cdn.github.com/favicon.ico" rel="icon" type="image/x-icon">
<meta content="998f98cdcaf9d3450e5b3d46c5485689873cdd8b" name="form-nonce"/>
<link crossorigin="anonymous" href="src/350888e1495e7af27e01faa9d8291dee.css" media="all" rel="stylesheet"/>
<link crossorigin="anonymous" href="src/9fae9b7d8f0785d745a43c6465f74ae5.css" media="all" rel="stylesheet"/>
<meta content="cd9958d45e48e8e3157a320e9c346eaa" http-equiv="x-pjax-version">
<meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="description">
<meta content="github.com/NetEase/pomelo git https://github.com/NetEase/pomelo.git" name="go-import">
<meta content="1460597" name="octolytics-dimension-user_id"/><meta content="NetEase" name="octolytics-dimension-user_login"/><meta content="5880912" name="octolytics-dimension-repository_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_nwo"/><meta content="true" name="octolytics-dimension-repository_public"/><meta content="false" name="octolytics-dimension-repository_is_fork"/><meta content="5880912" name="octolytics-dimension-repository_network_root_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_network_root_nwo"/>
<link href="https://github.com/NetEase/pomelo/commits/master.atom" rel="alternate" title="Recent Commits to pomelo:master" type="application/atom+xml">
</link></meta></meta></meta></link></link></meta></meta></meta></meta></meta></meta></meta></meta></meta></meta></link></meta></meta></meta></link></link></link></link></link></link></meta></meta></meta></meta></head><body style="padding:0 25px;"><div class="gollum-markdown-content instapaper_body" id="wiki-body">
<div class="markdown-body">
<h2>
<a aria-hidden="true" class="anchor" href="#compatibility" id="user-content-compatibility"><span class="octicon octicon-link"></span></a>Compatibility</h2>
<p>Pomelo plugins were introduced in version <code>0.6</code>.</p>
<h2>
<a aria-hidden="true" class="anchor" href="#plugin-structure" id="user-content-plugin-structure"><span class="octicon octicon-link"></span></a>Plugin Structure</h2>
<p>Pomelo plugins are divided into two sections: <strong>components</strong> (required) and <strong>events</strong> (optional):</p>
<p><img alt="plugin" data-canonical-src="http://pomelo.netease.com/resource/documentImage/plugin.png" src="https://camo.githubusercontent.com/555cf7986ce4cc53e5f96edc5ad45824e828698b/687474703a2f2f706f6d656c6f2e6e6574656173652e636f6d2f7265736f757263652f646f63756d656e74496d6167652f706c7567696e2e706e67"/></p>
<p>In Pomelo, a component is a reusable factory where each instance provides a service. For more in-depth information on Pomelo component architecture, see <a href="https://github.com/NetEase/pomelo/wiki/Pomelo-Framework-Reference">What is a component</a>.</p>
<p>Each plugin can have several components, and for each component developers can implement different life-cycle callbacks (e.g. <code>start</code>, <code>afterStart</code>, <code>stop</code>, etc.).</p>
<p>Each plugin dispatches the following events:</p>
<ul>
<li>
<code>'add_servers'</code>： event parameter is an Array of server information.</li>
<li>
<code>'remove_servers'</code>: event parameter is an Array of server information.</li>
<li>
<code>'replace_servers'</code>: internal server disconnect and reconnect event. Parameter is an Array of server information which have not disconnected.</li>
<li>
<code>'bind_session'</code>: session has been bound. Parameter is the session object.</li>
<li>
<code>'close_session'</code>: close session event (including connection error). Parameter is the session object.</li>
</ul>
<h2>
<a aria-hidden="true" class="anchor" href="#using-a-plugin" id="user-content-using-a-plugin"><span class="octicon octicon-link"></span></a>Using a Plugin</h2>
<p>Most plugin configuration will occur in your <code>app.js</code> file.</p>
<h4>
<a aria-hidden="true" class="anchor" href="#appuseplugin-options" id="user-content-appuseplugin-options"><span class="octicon octicon-link"></span></a><code>app.use(plugin, options);</code>
</h4>
<ul>
<li>
<code>'plugin'</code>: plugin definition</li>
<li>
<code>'options'</code>: plugin options</li>
</ul>
<p>Example:</p>
<pre><code>var statusPlugin = require('pomelo-status-plugin');
...
app.use(statusPlugin, {
  status: {
    host: '127.0.0.1',
    port: 6379
  }
});
...
</code></pre>
<h2>
<a aria-hidden="true" class="anchor" href="#building-a-plugin" id="user-content-building-a-plugin"><span class="octicon octicon-link"></span></a>Building a Plugin</h2>
<p>First, create a plugin project with directory structure like so:</p>
<p><img alt="plugin-dir" data-canonical-src="http://pomelo.netease.com/resource/documentImage/plugin-dir.png" src="https://camo.githubusercontent.com/9d2d3a2ed40da9c0bc206a46e0e979588226b5ac/687474703a2f2f706f6d656c6f2e6e6574656173652e636f6d2f7265736f757263652f646f63756d656e74496d6167652f706c7567696e2d6469722e706e67"/></p>
<p>Second, you need to configure the components and events in <code>index.js</code>:</p>
<pre><code>module.exports = {
  components: __dirname + '/lib/components/',
  events: __dirname + '/lib/events/'
};
</code></pre>
<p>Finally, you can add your components and events. For components, you need to export its constructor, the example code is as follow:</p>
<pre><code>module.exports = function(app, opts) {
  return new Component(app, opts);
};

var Component = function(app, opts) {
  //do construction
};

Component.prototype.start = function(cb) {
  // do something application start
};

Component.prototype.afterStart = function(cb) {
  // do something after application started
};

Component.prototype.stop = function(cb) {
  // do something on application stop
};
</code></pre>
<p>Events are similar:</p>
<pre><code>module.exports = function(app) {
  return new Event(app, opts);
};

var Event = function(app) {
  //do construction
};

Event.prototype.add_servers = function(servers) {
  //do something when application add servers
};

Event.prototype.remove_servers = function(ids) {
  //do something when application remove servers
};

Event.prototype.replace_servers = function(servers) {
  //do something when server reconnected
};

Event.prototype.bind_session = function(session) {
  //do something when session binded
};

Event.prototype.close_session = function(session) {
  //do something when session closed
};
</code></pre>
</div>
</div></body></html>