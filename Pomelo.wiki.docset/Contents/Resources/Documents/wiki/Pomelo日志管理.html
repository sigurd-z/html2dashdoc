<html><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#">
<meta charset="utf-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="en" http-equiv="Content-Language">
<meta content="width=1020" name="viewport">
<title>Pomelo日志管理 · NetEase/pomelo Wiki · GitHub</title>
<link href="/opensearch.xml" rel="search" title="GitHub" type="application/opensearchdescription+xml">
<link href="src/ad667adaa2cfe8f3caa4a41b7d0a79a1.png" rel="fluid-icon" title="GitHub">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="57x57">
<link href="src/a10d19ff5f738940a7a5086be334f50b.png" rel="apple-touch-icon" sizes="114x114">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="72x72">
<link href="src/b4cd268bc600cc14d2cdd557de6da2fb.png" rel="apple-touch-icon" sizes="144x144">
<meta content="1401488693436528" property="fb:app_id">
<meta content="@github" name="twitter:site"/><meta content="summary" name="twitter:card"/><meta content="NetEase/pomelo" name="twitter:title"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="twitter:description"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" name="twitter:image:src"/>
<meta content="GitHub" property="og:site_name"/><meta content="object" property="og:type"/><meta content="https://avatars0.githubusercontent.com/u/1460597?v=3&amp;s=400" property="og:image"/><meta content="NetEase/pomelo" property="og:title"/><meta content="https://github.com/NetEase/pomelo" property="og:url"/><meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." property="og:description"/>
<meta content="https://api.github.com/_private/browser/stats" name="browser-stats-url">
<meta content="https://api.github.com/_private/browser/errors" name="browser-errors-url">
<link href="https://assets-cdn.github.com/" rel="assets">
<meta content="1000" name="pjax-timeout">
<meta content="/windows-tile.png" name="msapplication-TileImage">
<meta content="#ffffff" name="msapplication-TileColor">
<meta data-pjax-transient="" name="selected-link" value="repo_wiki">
<meta content="KT5gs8h0wvaagLKAVWq8bbeNwnZZK1r1XQysX3xurLU" name="google-site-verification">
<meta content="UA-3769691-2" name="google-analytics">
<meta content="collector.githubapp.com" name="octolytics-host"/><meta content="github" name="octolytics-app-id"/><meta content="CA86616A:2F41:C8C1420:5670C0FE" name="octolytics-dimension-request_id"/>
<meta content="/&lt;user-name&gt;/&lt;repo-name&gt;/wiki/show" data-pjax-transient="true" name="analytics-location"/>
<meta content="Rails, view, wiki#show" data-pjax-transient="true" name="analytics-event"/>
<meta class="js-ga-set" content="Logged Out" name="dimension1">
<meta content="github.com" name="hostname">
<meta content="" name="user-login">
<meta content="github.com" name="expected-hostname">
<link color="#4078c0" href="https://assets-cdn.github.com/pinned-octocat.svg" rel="mask-icon">
<link href="https://assets-cdn.github.com/favicon.ico" rel="icon" type="image/x-icon">
<meta content="84e81b35526a5f29d7ab11c1b56ab93f6522e692" name="form-nonce"/>
<link crossorigin="anonymous" href="src/350888e1495e7af27e01faa9d8291dee.css" media="all" rel="stylesheet"/>
<link crossorigin="anonymous" href="src/9fae9b7d8f0785d745a43c6465f74ae5.css" media="all" rel="stylesheet"/>
<meta content="cd9958d45e48e8e3157a320e9c346eaa" http-equiv="x-pjax-version">
<meta content="pomelo - A fast,scalable,distributed game server framework for Node.js." name="description">
<meta content="github.com/NetEase/pomelo git https://github.com/NetEase/pomelo.git" name="go-import">
<meta content="1460597" name="octolytics-dimension-user_id"/><meta content="NetEase" name="octolytics-dimension-user_login"/><meta content="5880912" name="octolytics-dimension-repository_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_nwo"/><meta content="true" name="octolytics-dimension-repository_public"/><meta content="false" name="octolytics-dimension-repository_is_fork"/><meta content="5880912" name="octolytics-dimension-repository_network_root_id"/><meta content="NetEase/pomelo" name="octolytics-dimension-repository_network_root_nwo"/>
<link href="https://github.com/NetEase/pomelo/commits/master.atom" rel="alternate" title="Recent Commits to pomelo:master" type="application/atom+xml">
</link></meta></meta></meta></link></link></meta></meta></meta></meta></meta></meta></meta></meta></meta></meta></link></meta></meta></meta></link></link></link></link></link></link></meta></meta></meta></meta></head><body style="padding:0 25px;"><div class="gollum-markdown-content instapaper_body" id="wiki-body">
<div class="markdown-body">
<h1>
<a aria-hidden="true" class="anchor" href="#%E6%97%A5%E5%BF%97%E7%AE%A1%E7%90%86" id="user-content-日志管理"><span class="octicon octicon-link"></span></a>日志管理</h1>
<p>pomelo 日志是通过 <a href="https://github.com/NetEase/pomelo-logger">pomelo-logger</a> 模块来管理的，<a href="https://github.com/NetEase/pomelo-logger">pomelo-logger</a> 是对 <a href="https://github.com/nomiddlename/log4js-node">log4js</a> 的简单封装，并提供了一些非常有用的 feature。</p>
<p>日志是通过 category 来进行管理与维护的，可以在log4js.json文件中进行配置  </p>
<div class="highlight highlight-source-json"><pre>{
  <span class="pl-s"><span class="pl-pds">"</span>appenders<span class="pl-pds">"</span></span>: [
    {
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>console<span class="pl-pds">"</span></span>
    },
    {
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>file<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>filename<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>./logs/con-log-${opts:serverId}.log<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>pattern<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>connector<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>maxLogSize<span class="pl-pds">"</span></span>: <span class="pl-c1">1048576</span>,
      <span class="pl-s"><span class="pl-pds">"</span>layout<span class="pl-pds">"</span></span>: {
        <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>basic<span class="pl-pds">"</span></span>
      },
      <span class="pl-s"><span class="pl-pds">"</span>backups<span class="pl-pds">"</span></span>: <span class="pl-c1">5</span>,
      <span class="pl-s"><span class="pl-pds">"</span>category<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>con-log<span class="pl-pds">"</span></span>
    },
    {
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>file<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>filename<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>./logs/rpc-log-${opts:serverId}.log<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>maxLogSize<span class="pl-pds">"</span></span>: <span class="pl-c1">1048576</span>,
      <span class="pl-s"><span class="pl-pds">"</span>layout<span class="pl-pds">"</span></span>: {
        <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>basic<span class="pl-pds">"</span></span>
      },
      <span class="pl-s"><span class="pl-pds">"</span>backups<span class="pl-pds">"</span></span>: <span class="pl-c1">5</span>,
      <span class="pl-s"><span class="pl-pds">"</span>category<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>rpc-log<span class="pl-pds">"</span></span>
    },
    {
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>file<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>filename<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>./logs/forward-log-${opts:serverId}.log<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>maxLogSize<span class="pl-pds">"</span></span>: <span class="pl-c1">1048576</span>,
      <span class="pl-s"><span class="pl-pds">"</span>layout<span class="pl-pds">"</span></span>: {
        <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>basic<span class="pl-pds">"</span></span>
      },
      <span class="pl-s"><span class="pl-pds">"</span>backups<span class="pl-pds">"</span></span>: <span class="pl-c1">5</span>,
      <span class="pl-s"><span class="pl-pds">"</span>category<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>forward-log<span class="pl-pds">"</span></span>
    },
    {
     <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>file<span class="pl-pds">"</span></span>,
     <span class="pl-s"><span class="pl-pds">"</span>filename<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>./logs/rpc-debug-${opts:serverId}.log<span class="pl-pds">"</span></span>,
     <span class="pl-s"><span class="pl-pds">"</span>maxLogSize<span class="pl-pds">"</span></span>: <span class="pl-c1">1048576</span>,
     <span class="pl-s"><span class="pl-pds">"</span>layout<span class="pl-pds">"</span></span>: {
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>basic<span class="pl-pds">"</span></span>
     },
     <span class="pl-s"><span class="pl-pds">"</span>backups<span class="pl-pds">"</span></span>: <span class="pl-c1">5</span>,
     <span class="pl-s"><span class="pl-pds">"</span>category<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>rpc-debug<span class="pl-pds">"</span></span>
    },
    {
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>file<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>filename<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>./logs/crash.log<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>maxLogSize<span class="pl-pds">"</span></span>: <span class="pl-c1">1048576</span>,
      <span class="pl-s"><span class="pl-pds">"</span>layout<span class="pl-pds">"</span></span>: {
        <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>basic<span class="pl-pds">"</span></span>
      },
      <span class="pl-s"><span class="pl-pds">"</span>backups<span class="pl-pds">"</span></span>: <span class="pl-c1">5</span>,
      <span class="pl-s"><span class="pl-pds">"</span>category<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>crash-log<span class="pl-pds">"</span></span>
    },
    {
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>file<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>filename<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>./logs/admin.log<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>maxLogSize<span class="pl-pds">"</span></span>: <span class="pl-c1">1048576</span>,
      <span class="pl-s"><span class="pl-pds">"</span>layout<span class="pl-pds">"</span></span>: {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>basic<span class="pl-pds">"</span></span>
        }
      ,<span class="pl-s"><span class="pl-pds">"</span>backups<span class="pl-pds">"</span></span>: <span class="pl-c1">5</span>,
      <span class="pl-s"><span class="pl-pds">"</span>category<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>admin-log<span class="pl-pds">"</span></span>
    },
    {
      <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>file<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>filename<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>./logs/pomelo.log<span class="pl-pds">"</span></span>,
      <span class="pl-s"><span class="pl-pds">"</span>maxLogSize<span class="pl-pds">"</span></span>: <span class="pl-c1">1048576</span>,
      <span class="pl-s"><span class="pl-pds">"</span>layout<span class="pl-pds">"</span></span>: {
          <span class="pl-s"><span class="pl-pds">"</span>type<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>basic<span class="pl-pds">"</span></span>
        }
      ,<span class="pl-s"><span class="pl-pds">"</span>backups<span class="pl-pds">"</span></span>: <span class="pl-c1">5</span>,
      <span class="pl-s"><span class="pl-pds">"</span>category<span class="pl-pds">"</span></span>:<span class="pl-s"><span class="pl-pds">"</span>pomelo<span class="pl-pds">"</span></span>
    }
  ],

  <span class="pl-s"><span class="pl-pds">"</span>levels<span class="pl-pds">"</span></span>: {
    <span class="pl-s"><span class="pl-pds">"</span>rpc-log<span class="pl-pds">"</span></span> : <span class="pl-s"><span class="pl-pds">"</span>ERROR<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>forward-log<span class="pl-pds">"</span></span>: <span class="pl-s"><span class="pl-pds">"</span>ERROR<span class="pl-pds">"</span></span>
  },

  <span class="pl-s"><span class="pl-pds">"</span>replaceConsole<span class="pl-pds">"</span></span>: <span class="pl-c1">true</span>,
  <span class="pl-s"><span class="pl-pds">"</span>lineDebug<span class="pl-pds">"</span></span>: <span class="pl-c1">false</span>
}
</pre></div>
<p>从配置文件中可以看出，每一项（除了console项）都配了category，pomelo-logger 通过 getLogger 的第一个参数指定 category 来把该logger输出的日志定向到该category配置的文件或者其它输出方案。<br>
你可以添加自己的category，并在getLogger指定该category，你就可以把日志定向到该category所配的输出方案<br>
<strong>注意</strong>：不建议使用不指定category的方式来进行配置，这样子所有的logger都会定向到该全局的输出方案  </br></br></p>
<h3>
<a aria-hidden="true" class="anchor" href="#%E6%97%A5%E5%BF%97category" id="user-content-日志category"><span class="octicon octicon-link"></span></a>日志category</h3>
<p>在pomelo中有些指定的category用于输出日志：  </p>
<ul>
<li>pomelo： 输出 pomelo 框架里的日志<br>
</br></li>
<li>admin-log： 输出 pomelo-admin 用于监控client登陆master时输出的日志<br>
</br></li>
<li>crash-log： 输出服务器crash异常时的日志信息<br>
</br></li>
<li>rpc-debug： 输出 rpc-debug 的日志，需要开启 <a href="https://github.com/NetEase/pomelo/wiki/pomelo-0.6%E7%89%88%E6%96%B0%E7%89%B9%E6%80%A7#rpc-debug%E6%97%A5%E5%BF%97">rpc-debug 模式</a><br>
</br></li>
<li>forward-log : 输出从前端服务器转发到后端服务器的请求日志<br>
</br></li>
<li>rpc-log: 输出 rpc filter 上的日志<br>
</br></li>
<li>con-log: 输出 handler filter 上的日志<br>
</br></li>
</ul>
<h3>
<a aria-hidden="true" class="anchor" href="#%E6%97%A5%E5%BF%97levels" id="user-content-日志levels"><span class="octicon octicon-link"></span></a>日志levels</h3>
<p>可以通过指定日志的levels来控制输出的日志  </p>
<div class="highlight highlight-source-js"><pre><span class="pl-s"><span class="pl-pds">"</span>levels<span class="pl-pds">"</span></span><span class="pl-k">:</span> {
    <span class="pl-s"><span class="pl-pds">"</span>rpc-log<span class="pl-pds">"</span></span> <span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>ERROR<span class="pl-pds">"</span></span>,
    <span class="pl-s"><span class="pl-pds">"</span>forward-log<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>ERROR<span class="pl-pds">"</span></span>
}</pre></div>
<p>日志等级从左到右依次提升：  </p>
<pre><code>TRACE, DEBUG, INFO, WARN, ERROR, FATAL
</code></pre>
<p>在levels上等级配的越低，输出的日志范围则越大<br>
相反，则输出的日志范围越小<br>
比如：</br></br></p>
<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> rpc_logger <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>pomelo-logger<span class="pl-pds">'</span></span>).<span class="pl-en">getLogger</span>(<span class="pl-s"><span class="pl-pds">'</span>rpc-log<span class="pl-pds">'</span></span>, <span class="pl-c1">__filename</span>);
<span class="pl-smi">rpc_logger</span>.<span class="pl-c1">info</span>(<span class="pl-s"><span class="pl-pds">"</span>msg<span class="pl-pds">"</span></span>);</pre></div>
<p>这里rpc_logger的输出日志等级是 INFO，而 levels 上配的是 ERROR<br>
那么该日志就不会被输出到对应的appenders上面<br>
你需要levels改成低于 INFO 的级别，比如 DEBUG 才会把 rpc_logger 的日志输出  </br></br></p>
<h3>
<a aria-hidden="true" class="anchor" href="#%E6%97%A5%E5%BF%97%E9%85%8D%E7%BD%AE%E9%A1%B9%E8%AF%B4%E6%98%8E" id="user-content-日志配置项说明"><span class="octicon octicon-link"></span></a>日志配置项说明</h3>
<ul>
<li>type： 指定appenders的类型，可以是console， dataFile， file 等，具体详见 <a href="https://github.com/nomiddlename/log4js-node/wiki/Appenders">log4js</a>
</li>
<li>filename： 指定输出文件的路径</li>
<li>pattern：指定输出日志的pattern</li>
<li>maxLogSize：指定输出日志的最大大小</li>
<li>layout：指定输出的layout样式</li>
<li>backups：指定最大输出的文件数目</li>
<li>category：指定该appender对应的category，如果没有该项，说明该appender是一个全局的appender</li>
<li>replaceConsole：指定是否替换默认的console</li>
<li>lineDebug：指定是否开启debug显示日志行数</li>
</ul>
</div>
</div></body></html>